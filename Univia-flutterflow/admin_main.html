<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dormi 관리자 대시보드</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto&display=swap" rel="stylesheet">
  <!-- Firebase SDK 추가 -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <style>
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    @keyframes newMessageGlow {
      0% { box-shadow: 0 2px 8px rgba(211, 50, 47, 0.2); }
      50% { box-shadow: 0 4px 16px rgba(211, 50, 47, 0.4); }
      100% { box-shadow: 0 2px 8px rgba(211, 50, 47, 0.2); }
    }
    
    html, body {
      width: 100vw;
      height: 100vh;
      margin: 0;
      padding: 0;
      background: #f6f6f6;
      font-family: 'Roboto', sans-serif;
      box-sizing: border-box;
      overflow-x: hidden;
    }
    .dashboard-container {
      width: 100vw;
      height: 100vh;
      display: flex;
      background: #f6f6f6;
    }
    .sidebar {
      width: 20vw;
      min-width: 200px;
      max-width: 320px;
      background: #f6f6f6;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: flex-start;
      padding: 0;
      box-sizing: border-box;
      border-right: 1.5px solid #e0e0e0;
      border-top-right-radius: 24px;
      border-bottom-right-radius: 24px;
    }
    .sidebar-top {
      width: 100%;
    }
    .sidebar-logo {
      display: flex;
      align-items: center;
      padding: 32px 0 18px 32px;
    }
    .sidebar-logo-img {
      width: 54px;
      height: 54px;
      background: #5a638a;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 8px;
      cursor: pointer;
    }
    .sidebar-logo-img {
      background-image: url('dormii.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      background-color: transparent;
      mix-blend-mode: multiply;
    }
    .sidebar-logo-img::before {
      display: none;
    }
    .sidebar-logo-title {
      font-family: 'Montserrat', serif;
      font-size: 2.1rem;
      font-weight: 700;
      color: #444;
      cursor: pointer;
    }
    .sidebar-menu {
      width: 100%;
      margin-top: 18px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .menu-group {
      width: 100%;
      background: #ededed;
      border: none;
      border-bottom: 1px solid #e0e0e0;
      padding: 0;
      margin: 0;
      border-radius: 18px;
      margin-bottom: 6px;
      overflow: hidden;
    }
    .menu-group summary {
      font-size: 1.08rem;
      font-weight: 500;
      padding: 12px 0 12px 32px;
      cursor: pointer;
      outline: none;
      color: #222;
      list-style: none;
      border-radius: 18px;
      margin: 2px 8px;
      padding-left: 24px;
    }
    .menu-group ul li {
      cursor: pointer;
    }
    .menu-group[open] summary {
      background: #e0e0e0;
      border-radius: 18px 18px 0 0;
    }
    .menu-group ul {
      list-style: none;
      margin: 0;
      padding: 0 0 0 38px;
      font-size: 0.98rem;
      color: #555;
      border-radius: 0 0 18px 18px;
      margin-bottom: 6px;
    }
    .sidebar-bottom {
      width: 100%;
      padding: 0 0 18px 24px;
      font-size: 0.98rem;
      color: #444;
      border-radius: 0 0 18px 18px;
    }
    .sidebar-bottom .help {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-size: 0.97rem;
      cursor: pointer;
    }
    .sidebar-bottom .help::before {
      content: '\2753';
      margin-right: 6px;
      font-size: 1.1em;
    }
    .sidebar-bottom .logout {
      display: flex;
      align-items: center;
      cursor: pointer;
      color: #222;
      font-size: 0.97rem;
      margin-top: 8px;
    }
    .sidebar-bottom .logout::before {
      content: '\21B6';
      margin-right: 6px;
      font-size: 1.1em;
    }
    .main-content {
      flex: 1 1 0%;
      background: #f6f6f6;
      display: flex;
      flex-direction: column;
      min-width: 0;
      min-height: 0;
      padding: 0;
      border-radius: 0 0 24px 24px;
      margin-top: 12px;
      box-shadow: 0 4px 24px rgba(77,123,189,0.04);
    }
    .main-topbar {
      width: 100%;
      background: #4d7bbd;
      color: #fff;
      padding: 18px 32px 12px 32px;
      font-size: 1.08rem;
      font-weight: 500;
      display: flex;
      flex-direction: column;
      gap: 6px;
      border-radius: 24px;
      box-shadow: 0 2px 12px rgba(77,123,189,0.07);
    }
    .main-topbar strong {
      font-size: 1.13rem;
      font-weight: 700;
    }
    .main-topbar .info-row {
      display: flex;
      gap: 18px;
      font-size: 0.98rem;
      opacity: 0.95;
    }
    .main-topbar .info-label {
      font-weight: 400;
      opacity: 0.9;
    }
    .main-area {
      flex: 1 1 0%;
      padding: 32px 32px 0 32px;
      display: flex;
      flex-direction: column;
      min-width: 0;
      min-height: 0;
    }
    .status-section {
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      margin-bottom: 24px;
    }
    .status-title {
      width: 100%;
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 12px;
      color: #222;
    }
    .status-card {
      flex: 1 1 220px;
      min-width: 220px;
      max-width: 320px;
      background: #e6e6e6;
      border-radius: 24px;
      padding: 22px 18px 18px 22px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      font-size: 1.1rem;
      color: #222;
      box-sizing: border-box;
      min-height: 80px;
      margin-bottom: 0;
      box-shadow: 0 2px 12px rgba(77,123,189,0.07);
    }
    .status-card .card-label {
      font-size: 1.02rem;
      font-weight: 500;
      margin-bottom: 8px;
      color: #444;
    }
    .status-card .card-value {
      font-size: 2.1rem;
      font-weight: 700;
      color: #333;
    }
    .recent-section {
      width: 100%;
      margin-top: 18px;
      background: #e6e6e6;
      border-radius: 24px;
      min-height: 220px;
      box-sizing: border-box;
      padding: 0;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(77,123,189,0.07);
    }
    .recent-title {
      font-size: 1.25rem;
      font-weight: 500;
      background: #fff;
      padding: 14px 18px;
      border-bottom: 1.5px solid #ccc;
      color: #222;
      border-radius: 24px 24px 0 0;
    }
    .recent-content {
      padding: 24px 18px;
      color: #888;
      font-size: 1.05rem;
      min-height: 120px;
      background: #e6e6e6;
      border-radius: 0 0 24px 24px;
    }
    /* 대시보드 그래프 영역 둥글게 */
    #dashboard-view > .main-area > div[style*='background:#fff'] {
      border-radius: 24px !important;
      box-shadow: 0 2px 12px rgba(77,123,189,0.07) !important;
    }
    /* 객실현황 테이블 진짜 테이블처럼 */
    table {
      overflow: hidden;
      background: #fff;
      box-shadow: 0 2px 8px rgba(77,123,189,0.04);
      border-collapse: collapse;
      width: 100%;
      margin: 0;
    }
    table th, table td {
      border: 1px solid #e0e0e0;
      padding: 12px 8px;
      font-size: 1rem;
      text-align: center;
      vertical-align: middle;
    }
    table th {
      font-weight: 700;
      background: #f6f6f6;
    }
    table tbody tr {
      background: #fff;
      transition: background 0.2s;
    }
    table tbody tr:hover {
      background: #f0f4fa;
    }
    /* 상태 배지 둥글게 */
    td span[style*='border-radius'] {
      border-radius: 12px !important;
      display: inline-block;
      min-width: 56px;
      text-align: center;
      font-weight: 600;
      font-size: 0.97em;
      padding: 4px 0;
    }
    /* 테이블 내 상태 배지 둥글게 */
    td span[style*='border-radius'] {
      border-radius: 12px !important;
    }
    /* 페이지네이션 영역 둥글게 */
    div[style*='Rows per page'] {
      border-radius: 12px;
      background: #f6f6f6;
      margin: 8px 0;
      padding: 6px 12px;
      display: inline-block;
    }
    @media (max-width: 900px) {
      .dashboard-container {
        flex-direction: column;
      }
      .sidebar {
        width: 100vw;
        min-width: 0;
        max-width: 100vw;
        flex-direction: row;
        align-items: flex-start;
        border-right: none;
        border-bottom: 1.5px solid #e0e0e0;
        height: auto;
        border-radius: 0 0 24px 24px;
      }
      .sidebar-top, .sidebar-bottom {
        padding-left: 12px;
      }
      .main-content {
        min-width: 0;
        border-radius: 24px 24px 0 0;
      }
      .main-area {
        padding: 18px 6vw 0 6vw;
      }
      .status-section {
        gap: 10px;
      }
      .status-card {
        min-width: 120px;
        max-width: 100vw;
        padding: 14px 10px 12px 14px;
      }
      .recent-section {
        min-height: 120px;
        border-radius: 24px;
      }
      .main-content {
        border-radius: 0 0 24px 24px;
      }
      .main-topbar {
        border-radius: 24px;
      }
    }
    @media (max-width: 600px) {
      .sidebar {
        flex-direction: column;
        width: 100vw;
        min-width: 0;
        max-width: 100vw;
        padding: 0;
        border-radius: 0 0 18px 18px;
      }
      .sidebar-logo {
        padding: 18px 0 10px 12px;
      }
      .sidebar-logo-img {
        width: 36px;
        height: 36px;
        margin-right: 7px;
      }
      .sidebar-logo-title {
        font-size: 1.1rem;
      }
      .main-topbar {
        padding: 10px 10px 8px 10px;
        font-size: 0.98rem;
        border-radius: 18px;
      }
      .main-area {
        padding: 10px 2vw 0 2vw;
      }
      .status-title {
        font-size: 1.1rem;
      }
      .recent-title {
        font-size: 1.05rem;
        padding: 10px 8px;
      }
      .recent-content {
        padding: 10px 8px;
        font-size: 0.98rem;
      }
      table {
        border-radius: 12px;
      }
    }
    /* 객실현황 테이블을 감싸는 div에만 border-radius 적용 (꼭짓점 자연스럽게) */
    .dashboard-container .main-content .main-area > div > div[style*='background:#fff'] {
      border-radius: 18px !important;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <aside class="sidebar">
      <div class="sidebar-top">
        <div class="sidebar-logo">
          <div class="sidebar-logo-img" id="dashboard-logo"></div>
          <div class="sidebar-logo-title" id="dashboard-title">Dormi</div>
        </div>
        
        <!-- 관리자 정보 표시 영역 -->
        <div id="admin-info" style="display: none; margin: 0 24px 16px 24px; padding: 12px; background: #e8f4fd; border-radius: 8px; border-left: 4px solid #1976d2;">
          <div style="font-size: 12px; color: #666; margin-bottom: 4px;">현재 로그인</div>
          <div id="admin-name" style="font-size: 14px; font-weight: 600; color: #1976d2;"></div>
        </div>
        
        <nav class="sidebar-menu">

          <details class="menu-group" id="member-menu">
            <summary id="member-menu-summary">회원 관리</summary>
            <ul>
              <li style="font-weight:600;color:#1976d2;">전체 학생: 5명</li>
              <li id="member-list-link">회원 목록</li>
            </ul>
          </details>
          <details class="menu-group">
            <summary>기숙사 관리</summary>
            <ul>
              <li id="dorm-leave-link">외박 신청 관리</li>
              <li id="complaint-link">민원관리</li>
              <li id="point-link">상벌점 관리</li>
              <li>퇴사 신청 관리</li>
            </ul>
          </details>
          
          <details class="menu-group">
            <summary>공지사항 관리</summary>
            <ul><li id="notice-link">공지사항</li></ul>
          </details>
          <details class="menu-group">
            <summary>일정관리</summary>
            <ul><li id="schedule-link">일정관리</li></ul>
          </details>

          <details class="menu-group">
            <summary>메시지</summary>
            <ul><li id="message-link">메시지 관리</li></ul>
          </details>
          
          <details class="menu-group">
            <summary>입사</summary>
            <ul>
              <li id="dorm-in-link">입사 신청 관리</li>
            </ul>
          </details>
        </nav>
      </div>
      <div class="sidebar-bottom">
        <div class="help">도움이 필요하신가요?</div>
        <div class="logout">로그아웃</div>
      </div>
    </aside>
    <main class="main-content">
      <!-- ===== 대시보드 페이지 ===== -->
      <div id="dashboard-view">
        <div class="main-topbar">
          <strong>신한대학교</strong>
        </div>
        <div class="main-area">

          <!-- 통계 카드 위젯 -->
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:36px;">
            <div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:24px;text-align:center;">
              <div style="font-size:2.5rem;font-weight:700;color:#4d7bbd;margin-bottom:8px;" id="total-students">0</div>
              <div style="font-size:1rem;color:#666;font-weight:600;">전체 학생 인원</div>
            </div>
            <div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:24px;text-align:center;">
              <div style="font-size:2.5rem;font-weight:700;color:#ff9800;margin-bottom:8px;" id="pending-applications-count">0</div>
              <div style="font-size:1rem;color:#666;font-weight:600;">미처리 신청 건수</div>
            </div>
            <div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:24px;text-align:center;">
              <div style="font-size:2.5rem;font-weight:700;color:#d32f2f;margin-bottom:8px;" id="new-messages-count">0</div>
              <div style="font-size:1rem;color:#666;font-weight:600;">새로운 메시지 건수</div>
            </div>
            </div>

          <!-- 앞으로의 일주일 일정 -->
          <div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 0 24px 0;margin-bottom:36px;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">앞으로의 일주일 일정</div>
            <div style="padding:18px 18px 0 18px;">
              <div id="weekly-schedule" style="display:grid;gap:12px;">
                <!-- 일정들은 JavaScript로 동적 생성 -->
            </div>
          </div>
          </div>
          <!-- 미처리 신청 (스크롤해야 보이게 fold 아래) -->
          <div style="margin-top:60px;">
            <div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 32px 12px 32px;overflow-x:auto;">
              <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">미처리 신청</div>
              <div id="pending-applications" style="padding:18px 18px 0 18px;">
                <!-- 대기 상태 항목들은 JavaScript로 동적 생성 -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- ===== 회원 관리 페이지 ===== -->
      <div id="member-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>회원 관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">회원 관리</div>
            <select style="padding:7px 18px;border-radius:6px;border:1.2px solid #bbb;font-size:1rem;">
              <option>마곡관</option>
              <option>기숙사A</option>
              <option>기숙사B</option>
            </select>
          </div>
          <div style="margin-bottom:12px;">
            <input type="text" id="member-search" placeholder="이름 검색" style="width:260px;padding:8px 12px;border-radius:6px;border:1.2px solid #bbb;font-size:1rem;">
          </div>
          <div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 0 12px 0;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.08rem;">현재 회원명 리스트 (5명)</div>
            <table style="width:100%;border-collapse:collapse;margin-top:8px;font-size:0.98rem;">
              <thead>
                <tr style="background:#f6f6f6;">
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">#</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">이름 / 학번</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">학과 / 학년</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">성별</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">입사기간</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">퇴사일자</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">청구 금액</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">납부액</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>고다현<br><span style="color:#888;font-size:0.93em;">20230709</span></td>
                  <td>소프트웨어융합대학 2학년</td>
                  <td>남자</td>
                  <td>6개월</td>
                  <td>2025-03-25</td>
                  <td style="color:#388e3c;font-weight:600;">270,000</td>
                  <td style="color:#444;">500,000</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>노홍철<br><span style="color:#888;font-size:0.93em;">20230627</span></td>
                  <td>Lorem ipsum dolor sit amet...</td>
                  <td>여자</td>
                  <td>4개월</td>
                  <td>-</td>
                  <td style="color:#d32f2f;font-weight:600;">-20,000</td>
                  <td style="color:#444;">500,000</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>이하준<br><span style="color:#888;font-size:0.93em;">20230528</span></td>
                  <td>Lorem ipsum dolor sit amet...</td>
                  <td>남자</td>
                  <td>3개월</td>
                  <td>-</td>
                  <td style="color:#388e3c;font-weight:600;">800,000</td>
                  <td style="color:#444;">500,000</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>Leo Stanton<br><span style="color:#888;font-size:0.93em;">20230413</span></td>
                  <td>Lorem ipsum dolor sit amet...</td>
                  <td>여자</td>
                  <td>2개월</td>
                  <td>-</td>
                  <td style="color:#d32f2f;font-weight:600;">-270,000</td>
                  <td style="color:#444;">500,000</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>Kayla Vetovos<br><span style="color:#888;font-size:0.93em;">20230316</span></td>
                  <td>Lorem ipsum dolor sit amet...</td>
                  <td>여자</td>
                  <td>3개월</td>
                  <td>-</td>
                  <td style="color:#d32f2f;font-weight:600;">-335,000</td>
                  <td style="color:#444;">500,000</td>
                </tr>
              </tbody>
            </table>
            <div style="padding:10px 18px 0 18px;color:#888;font-size:0.97em;">1-5 of 97 &nbsp; &nbsp; Rows per page: 10 <span style="font-size:1.2em;vertical-align:middle;">◀️ ▶️</span></div>
          </div>
        </div>
      </div>
      <!-- ===== 공지사항 관리 페이지 ===== -->
      <div id="notice-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>공지사항 관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">공지사항 관리</div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
            <input type="text" id="notice-search" placeholder="공지사항 제목 검색" style="width:260px;padding:8px 12px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
            <button id="add-notice-btn" style="padding:6px 24px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;white-space:nowrap;">+ 공지사항 추가</button>
          </div>
          <div style="background:#fff;border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 32px 12px 32px;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">공지사항 리스트</div>
            <table id="notice-table" style="width:100%;border-collapse:collapse;margin-top:8px;font-size:0.98rem;">
              <thead>
                <tr style="background:#f6f6f6;">
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">제목</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">작성자</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">작성일</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">조회수</th>
                  <th style="padding:8px 4px;border-bottom:1.5px solid #e0e0e0;">관리</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showNoticeDetail('2024년 기숙사 입사 안내', '관리자', '2024-01-15', '기숙사 입사 관련 안내사항입니다.')">2024년 기숙사 입사 안내</td>
                  <td>관리자</td>
                  <td>2024-01-15</td>
                  <td>156</td>
                  <td>
                    <button onclick="editNotice(1)" style="padding:4px 8px;font-size:0.9em;border:none;border-radius:4px;background:#4d7bbd;color:#fff;cursor:pointer;margin-right:4px;">수정</button>
                    <button onclick="deleteNotice(1)" style="padding:4px 8px;font-size:0.9em;border:none;border-radius:4px;background:#d32f2f;color:#fff;cursor:pointer;">삭제</button>
                  </td>
                </tr>
                <tr>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showNoticeDetail('기숙사 규정 변경 안내', '관리자', '2024-01-10', '기숙사 규정이 변경되었습니다.')">기숙사 규정 변경 안내</td>
                  <td>관리자</td>
                  <td>2024-01-10</td>
                  <td>89</td>
                  <td>
                    <button onclick="editNotice(2)" style="padding:4px 8px;font-size:0.9em;border:none;border-radius:4px;background:#4d7bbd;color:#fff;cursor:pointer;margin-right:4px;">수정</button>
                    <button onclick="deleteNotice(2)" style="padding:4px 8px;font-size:0.9em;border:none;border-radius:4px;background:#d32f2f;color:#fff;cursor:pointer;">삭제</button>
                  </td>
                </tr>
                <tr>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showNoticeDetail('외박 신청 절차 안내', '관리자', '2024-01-05', '외박 신청 절차에 대한 안내입니다.')">외박 신청 절차 안내</td>
                  <td>관리자</td>
                  <td>2024-01-05</td>
                  <td>234</td>
                  <td>
                    <button onclick="editNotice(3)" style="padding:4px 8px;font-size:0.9em;border:none;border-radius:4px;background:#4d7bbd;color:#fff;cursor:pointer;margin-right:4px;">수정</button>
                    <button onclick="deleteNotice(3)" style="padding:4px 8px;font-size:0.9em;border:none;border-radius:4px;background:#d32f2f;color:#fff;cursor:pointer;">삭제</button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div style="padding:10px 18px 0 18px;color:#888;font-size:0.97em;">1-3 of 3 &nbsp; &nbsp; Rows per page: 10 <span style="font-size:1.2em;vertical-align:middle;">◀️ ▶️</span></div>
          </div>
        </div>
      </div>
      <!-- ===== 메시지 관리 페이지 ===== -->
      <div id="message-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>실시간 채팅 관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">실시간 채팅</div>
            <div style="display:flex;gap:8px;">
              <div style="display:flex;align-items:center;gap:8px;">
                <span style="font-size:0.9rem;color:#666;">현재 관리자:</span>
                <span id="current-admin-display" style="font-weight:600;color:#4d7bbd;padding:4px 8px;background:#e3f2fd;border-radius:4px;"></span>
              </div>
              <div style="display:flex;gap:8px;">
                <button id="refresh-chats-btn" style="padding:8px 16px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;">새로고침</button>
                <button onclick="createSampleChatData()" style="padding:8px 16px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#ff9800;color:#fff;cursor:pointer;">테스트 데이터</button>
              </div>
            </div>
          </div>
          <div style="margin-bottom:12px;">
            <input type="text" id="message-search" placeholder="학생 이름 또는 학번 검색" style="width:260px;padding:8px 12px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
          </div>
          <div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 0 24px 0;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">실시간 채팅 목록</div>
            <div style="padding:18px 18px 0 18px;">
              <div id="chat-list" style="display:grid;gap:12px;">
                <!-- 채팅 목록은 JavaScript로 동적 생성 -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- ===== 일정관리 페이지 ===== -->
      <div id="schedule-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>일정관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">일정관리</div>
            <button id="add-schedule-btn" style="padding:6px 24px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;white-space:nowrap;">+ 일정 추가</button>
          </div>
          <div style="background:#fff;border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:32px;overflow-x:auto;">
            <div id="calendar-container" style="width:100%;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
                <div style="display:flex;align-items:center;gap:12px;">
                  <button id="prev-month" style="padding:8px 16px;font-size:1rem;border:none;border-radius:8px;background:#f5f5f5;color:#333;cursor:pointer;">◀</button>
                  <h2 id="current-month" style="margin:0;color:#333;font-size:1.5rem;font-weight:600;">2024년 1월</h2>
                  <button id="next-month" style="padding:8px 16px;font-size:1rem;border:none;border-radius:8px;background:#f5f5f5;color:#333;cursor:pointer;">▶</button>
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                  <input type="number" id="year-search" placeholder="년도" min="2000" max="2100" style="width:80px;padding:6px 8px;border-radius:6px;border:1px solid #ddd;font-size:0.9rem;">
                  <span style="color:#666;font-size:0.9rem;">년</span>
                  <input type="number" id="month-search" placeholder="월" min="1" max="12" style="width:60px;padding:6px 8px;border-radius:6px;border:1px solid #ddd;font-size:0.9rem;">
                  <span style="color:#666;font-size:0.9rem;">월</span>
                  <button id="go-to-date" style="padding:6px 12px;font-size:0.9rem;border:none;border-radius:6px;background:#4d7bbd;color:#fff;cursor:pointer;">이동</button>
                </div>
              </div>
              <div id="calendar-grid" style="display:grid;grid-template-columns:repeat(7, 1fr);gap:1px;background:#f5f5f5;border-radius:8px;overflow:hidden;">
                <!-- 요일 헤더 -->
                <div style="background:#f6f6f6;padding:12px;text-align:center;font-weight:600;color:#555;">일</div>
                <div style="background:#f6f6f6;padding:12px;text-align:center;font-weight:600;color:#555;">월</div>
                <div style="background:#f6f6f6;padding:12px;text-align:center;font-weight:600;color:#555;">화</div>
                <div style="background:#f6f6f6;padding:12px;text-align:center;font-weight:600;color:#555;">수</div>
                <div style="background:#f6f6f6;padding:12px;text-align:center;font-weight:600;color:#555;">목</div>
                <div style="background:#f6f6f6;padding:12px;text-align:center;font-weight:600;color:#555;">금</div>
                <div style="background:#f6f6f6;padding:12px;text-align:center;font-weight:600;color:#555;">토</div>
                <!-- 달력 날짜들은 JavaScript로 동적 생성 -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- ===== 출석/점호 페이지 ===== -->
      <div id="dorm-apply-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>출석/점호</strong>
        </div>
        <div class="main-area">
          <div style="margin-bottom:12px;">
            <input id="attendance-search" type="text" placeholder="이름 또는 학번 검색" style="width:260px;padding:8px 12px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
          </div>
          <div style="background:#fff;border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 32px 12px 32px;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">객실 현황</div>
            <table id="attendance-table" style="width:100%;border-collapse:collapse;margin-top:8px;font-size:0.98rem;">
              <thead>
                <tr style="background:#f6f6f6;">
                  <th>방 호수</th>
                  <th>이름/학번</th>
                  <th>입실 시간</th>
                  <th>입실 여부</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>201호</td>
                  <td>김지현 / 20230627</td>
                  <td>2:09PM</td>
                  <td><span style="background:#ffb300;color:#fff;padding:2px 10px;border-radius:8px;font-size:0.93em;">외출중</span></td>
                </tr>
                <tr>
                  <td>201호</td>
                  <td>이승우 / 20230709</td>
                  <td>2:04PM</td>
                  <td><span style="background:#43a047;color:#fff;padding:2px 10px;border-radius:8px;font-size:0.93em;">입실중</span></td>
                </tr>
                <tr>
                  <td>305호</td>
                  <td>박민수 / 20230528</td>
                  <td>1:55PM</td>
                  <td><span style="background:#bdbdbd;color:#222;padding:2px 10px;border-radius:8px;font-size:0.93em;">퇴실</span></td>
                </tr>
                <tr>
                  <td>305호</td>
                  <td>최유진 / 20230811</td>
                  <td>2:11PM</td>
                  <td><span style="background:#43a047;color:#fff;padding:2px 10px;border-radius:8px;font-size:0.93em;">입실중</span></td>
                </tr>
              </tbody>
            </table>
            <div style="padding:10px 18px 0 18px;color:#888;font-size:0.97em;">1-4 of 20 &nbsp; &nbsp; Rows per page: 10 <span style="font-size:1.2em;vertical-align:middle;">◀️ ▶️</span></div>
          </div>
        </div>
      </div>
      <!-- ===== 외박 신청 관리 페이지 ===== -->
      <div id="dorm-leave-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>외박 신청 관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">외박 신청 내역</div>
            <select style="padding:7px 18px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
              <option>전체 기숙사</option>
              <option>마곡관</option>
              <option>기숙사A</option>
              <option>기숙사B</option>
            </select>
          </div>
          <div style="margin-bottom:12px;">
            <input type="text" id="leave-search" placeholder="이름 또는 학번 검색" style="width:260px;padding:8px 12px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
          </div>
          <div style="background:#fff;border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 32px 12px 32px;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">외박 신청 리스트</div>
            <table id="dorm-leave-table" style="width:100%;border-collapse:collapse;margin-top:8px;font-size:0.98rem;">
              <thead>
                <tr style="background:#f6f6f6;">
                  <th style="width:40px;"><input type="checkbox" id="check-all-leave"></th>
                  <th>이름</th>
                  <th>학번</th>
                  <th>학과/학년</th>
                  <th>성별</th>
                  <th>외박 시작일</th>
                  <th>외박 종료일</th>
                  <th>신청일</th>
                  <th>상태</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><input type="checkbox" class="leave-row-check"></td>
                  <td>이승우</td>
                  <td>20230709</td>
                  <td>소프트웨어융합대학 2학년</td>
                  <td>남</td>
                  <td>2024-06-01</td>
                  <td>2024-06-03</td>
                  <td>2024-05-30</td>
                  <td>
                    <select class="leave-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="leave-row-check"></td>
                  <td>김지현</td>
                  <td>20230627</td>
                  <td>경영학과 1학년</td>
                  <td>여</td>
                  <td>2024-06-02</td>
                  <td>2024-06-04</td>
                  <td>2024-05-31</td>
                  <td>
                    <select class="leave-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="leave-row-check"></td>
                  <td>박민수</td>
                  <td>20230528</td>
                  <td>전자공학과 3학년</td>
                  <td>남</td>
                  <td>2024-06-05</td>
                  <td>2024-06-07</td>
                  <td>2024-06-01</td>
                  <td>
                    <select class="leave-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
            <div style="display:flex;justify-content:center;margin-top:18px;">
              <button id="leave-confirm-btn" style="padding:12px 38px;font-size:1.1em;font-weight:700;border:none;border-radius:18px;background:#4d7bbd;color:#fff;box-shadow:0 2px 8px rgba(77,123,189,0.08);cursor:pointer;">확인하기</button>
            </div>
            <div style="padding:10px 18px 0 18px;color:#888;font-size:0.97em;">1-3 of 10 &nbsp; &nbsp; Rows per page: 10 <span style="font-size:1.2em;vertical-align:middle;">◀️ ▶️</span></div>
          </div>
        </div>
      </div>
      <!-- ===== 민원관리 페이지 ===== -->
      <div id="complaint-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>민원관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">민원 관리</div>
            <select style="padding:7px 18px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
              <option>전체 기숙사</option>
              <option>마곡관</option>
              <option>기숙사A</option>
              <option>기숙사B</option>
            </select>
          </div>
          <div style="margin-bottom:12px;">
            <input type="text" id="complaint-search" placeholder="이름 또는 학번 검색" style="width:260px;padding:8px 12px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
          </div>
          <div style="background:#fff;border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 32px 12px 32px;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">민원 리스트</div>
            <table id="complaint-table" style="width:100%;border-collapse:collapse;margin-top:8px;font-size:0.98rem;">
              <thead>
                <tr style="background:#f6f6f6;">
                  <th style="width:40px;"><input type="checkbox" id="check-all-complaint"></th>
                  <th>이름</th>
                  <th>학번</th>
                  <th>학과</th>
                  <th>성별</th>
                  <th>민원 제목</th>
                  <th>상태</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><input type="checkbox" class="complaint-row-check"></td>
                  <td>이승우</td>
                  <td>20230709</td>
                  <td>소프트웨어융합대학</td>
                  <td>남</td>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showComplaintDetail('이승우', '시설물 고장 신고')">시설물 고장 신고</td>
                  <td>
                    <select class="complaint-status-select" data-original-status="대기" onchange="updateComplaintSelectColor(this)" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="complaint-row-check"></td>
                  <td>김지현</td>
                  <td>20230627</td>
                  <td>경영학과</td>
                  <td>여</td>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showComplaintDetail('김지현', '소음 민원')">소음 민원</td>
                  <td>
                    <select class="complaint-status-select" data-original-status="승인" onchange="updateComplaintSelectColor(this)" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#43a047;color:#fff;font-weight:600;border:none;'>
                      <option value='승인' selected>승인</option>
                      <option value='대기'>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="complaint-row-check"></td>
                  <td>박민수</td>
                  <td>20230528</td>
                  <td>전자공학과</td>
                  <td>남</td>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showComplaintDetail('박민수', '온수 공급 문제')">온수 공급 문제</td>
                  <td>
                    <select class="complaint-status-select" data-original-status="반려" onchange="updateComplaintSelectColor(this)" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#d32f2f;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기'>대기</option>
                      <option value='반려' selected>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="complaint-row-check"></td>
                  <td>최유진</td>
                  <td>20230811</td>
                  <td>컴퓨터공학과</td>
                  <td>여</td>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showComplaintDetail('최유진', '보안 문 잠금 장치')">보안 문 잠금 장치</td>
                  <td>
                    <select class="complaint-status-select" data-original-status="대기" onchange="updateComplaintSelectColor(this)" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
            <div style="display:flex;justify-content:center;margin-top:18px;">
              <button id="complaint-confirm-btn" style="padding:12px 38px;font-size:1.1em;font-weight:700;border:none;border-radius:18px;background:#4d7bbd;color:#fff;box-shadow:0 2px 8px rgba(77,123,189,0.08);cursor:pointer;">확인하기</button>
            </div>
            <div style="padding:10px 18px 0 18px;color:#888;font-size:0.97em;">1-4 of 15 &nbsp; &nbsp; Rows per page: 10 <span style="font-size:1.2em;vertical-align:middle;">◀️ ▶️</span></div>
          </div>
        </div>
      </div>
      <!-- ===== 상벌점 관리 페이지 ===== -->
      <div id="point-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>상벌점 관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">상벌점 관리</div>
            <select style="padding:7px 18px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
              <option>전체 기숙사</option>
              <option>마곡관</option>
              <option>기숙사A</option>
              <option>기숙사B</option>
            </select>
          </div>
          <div style="margin-bottom:12px;display:flex;gap:10px;align-items:center;">
            <input type="text" id="point-search" placeholder="이름 또는 학번 검색" style="width:260px;padding:8px 12px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
            <button id="add-point-btn" style="padding:8px 16px;font-size:1rem;font-weight:600;border:none;border-radius:18px;background:#4d7bbd;color:#fff;box-shadow:0 2px 8px rgba(77,123,189,0.08);cursor:pointer;">+ 상벌점 추가</button>
          </div>
          <div style="background:#fff;border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 32px 12px 32px;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">상벌점 리스트</div>
            <table id="point-table" style="width:100%;border-collapse:collapse;margin-top:8px;font-size:0.98rem;">
                              <thead>
                  <tr style="background:#f6f6f6;">
                    <th>이름</th>
                    <th>학번</th>
                    <th>학과</th>
                    <th>성별</th>
                    <th>방 호수</th>
                    <th>날짜</th>
                    <th>현재 점수</th>
                    <th>상벌점 내역</th>
                  </tr>
                </thead>
                              <tbody>
                  <tr>
                    <td>이승우</td>
                    <td>20230709</td>
                    <td>소프트웨어융합대학</td>
                    <td>남</td>
                    <td>201호</td>
                    <td>2024-06-01</td>
                    <td style="color:#43a047;font-weight:600;">+15점</td>
                    <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showPointDetail('이승우', '2024-06-01', '정리정돈 우수', 5)">정리정돈 우수</td>
                  </tr>
                  <tr>
                    <td>김지현</td>
                    <td>20230627</td>
                    <td>경영학과</td>
                    <td>여</td>
                    <td>305호</td>
                    <td>2024-06-02</td>
                    <td style="color:#d32f2f;font-weight:600;">-5점</td>
                    <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showPointDetail('김지현', '2024-06-02', '소음 민원', -3)">소음 민원</td>
                  </tr>
                  <tr>
                    <td>박민수</td>
                    <td>20230528</td>
                    <td>전자공학과</td>
                    <td>남</td>
                    <td>110호</td>
                    <td>2024-06-03</td>
                    <td style="color:#43a047;font-weight:600;">+10점</td>
                    <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showPointDetail('박민수', '2024-06-03', '기숙사 행사 참여', 3)">기숙사 행사 참여</td>
                  </tr>
                  <tr>
                    <td>최유진</td>
                    <td>20230811</td>
                    <td>컴퓨터공학과</td>
                    <td>여</td>
                    <td>405호</td>
                    <td>2024-06-04</td>
                    <td style="color:#d32f2f;font-weight:600;">-3점</td>
                    <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showPointDetail('최유진', '2024-06-04', '기숙사 규정 위반', -2)">기숙사 규정 위반</td>
                  </tr>
                </tbody>
            </table>
            <div style="display:flex;justify-content:center;margin-top:18px;">
              <button id="point-confirm-btn" style="padding:12px 38px;font-size:1.1em;font-weight:700;border:none;border-radius:18px;background:#4d7bbd;color:#fff;box-shadow:0 2px 8px rgba(77,123,189,0.08);cursor:pointer;">확인하기</button>
            </div>
            <div style="padding:10px 18px 0 18px;color:#888;font-size:0.97em;">1-4 of 12 &nbsp; &nbsp; Rows per page: 10 <span style="font-size:1.2em;vertical-align:middle;">◀️ ▶️</span></div>
          </div>
        </div>
      </div>
      <!-- ===== 퇴사 신청 관리 페이지 ===== -->
      <div id="dorm-out-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>퇴사 신청 관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">퇴사 신청 내역</div>
            <select style="padding:7px 18px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
              <option>전체 기숙사</option>
              <option>마곡관</option>
              <option>기숙사A</option>
              <option>기숙사B</option>
            </select>
          </div>
          <div style="margin-bottom:12px;">
            <input type="text" id="out-search" placeholder="이름 또는 학번 검색" style="width:260px;padding:8px 12px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
          </div>
          <div style="background:#fff;border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 32px 12px 32px;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">퇴사 신청 리스트</div>
            <table id="dorm-out-table" style="width:100%;border-collapse:collapse;margin-top:8px;font-size:0.98rem;">
              <thead>
                <tr style="background:#f6f6f6;">
                  <th style="width:40px;"><input type="checkbox" id="check-all-out"></th>
                  <th>이름</th>
                  <th>학번</th>
                  <th>학과/학년</th>
                  <th>성별</th>
                  <th>방 호수</th>
                  <th>희망 퇴실일</th>
                  <th>신청일</th>
                  <th>상태</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><input type="checkbox" class="out-row-check"></td>
                  <td>이승우</td>
                  <td>20230709</td>
                  <td>소프트웨어융합대학 2학년</td>
                  <td>남</td>
                  <td>201호</td>
                  <td>2024-06-20</td>
                  <td>2024-06-01</td>
                  <td>
                    <select class="out-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="out-row-check"></td>
                  <td>김지현</td>
                  <td>20230627</td>
                  <td>경영학과 1학년</td>
                  <td>여</td>
                  <td>305호</td>
                  <td>2024-06-22</td>
                  <td>2024-06-02</td>
                  <td>
                    <select class="out-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="out-row-check"></td>
                  <td>박민수</td>
                  <td>20230528</td>
                  <td>전자공학과 3학년</td>
                  <td>남</td>
                  <td>110호</td>
                  <td>2024-06-25</td>
                  <td>2024-06-03</td>
                  <td>
                    <select class="out-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
            <div style="display:flex;justify-content:center;margin-top:18px;">
              <button id="out-confirm-btn" style="padding:12px 38px;font-size:1.1em;font-weight:700;border:none;border-radius:18px;background:#4d7bbd;color:#fff;box-shadow:0 2px 8px rgba(77,123,189,0.08);cursor:pointer;">확인하기</button>
            </div>
            <div style="padding:10px 18px 0 18px;color:#888;font-size:0.97em;">1-3 of 10 &nbsp; &nbsp; Rows per page: 10 <span style="font-size:1.2em;vertical-align:middle;">◀️ ▶️</span></div>
          </div>
        </div>
      </div>
      <!-- ===== 입사 신청 관리 페이지 ===== -->
      <div id="dorm-in-view" style="display:none;">
        <div class="main-topbar" style="background:#4d7bbd;">
          <strong>입사 신청 관리</strong>
        </div>
        <div class="main-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
            <div class="status-title" style="margin-bottom:0;">입사 신청 내역</div>
            <select style="padding:7px 18px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
              <option>전체 기숙사</option>
              <option>마곡관</option>
              <option>기숙사A</option>
              <option>기숙사B</option>
            </select>
          </div>
          <div style="margin-bottom:12px;">
            <input type="text" id="in-search" placeholder="이름 또는 학번 검색" style="width:260px;padding:8px 12px;border-radius:18px;border:1.2px solid #bbb;font-size:1rem;">
          </div>
          <div style="background:#fff;border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 32px 12px 32px;overflow-x:auto;">
            <div style="padding:18px 18px 0 18px;font-weight:600;font-size:1.13rem;">입사 신청 리스트</div>
            <table id="dorm-in-table" style="width:100%;border-collapse:collapse;margin-top:8px;font-size:0.98rem;">
              <thead>
                <tr style="background:#f6f6f6;">
                  <th style="width:40px;"><input type="checkbox" id="check-all-in"></th>
                  <th>이름</th>
                  <th>학번</th>
                  <th>학과</th>
                  <th>학년</th>
                  <th>본인 연락처</th>
                  <th>희망 입사일</th>
                  <th>신청일</th>
                  <th>상태</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><input type="checkbox" class="in-row-check"></td>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showInDetail('김영수', '20240801', '컴퓨터공학과', '1학년', '010-1234-5678', '2024-03-01', '2024-02-15')">김영수</td>
                  <td>20240801</td>
                  <td>컴퓨터공학과</td>
                  <td>1학년</td>
                  <td>010-1234-5678</td>
                  <td>2024-03-01</td>
                  <td>2024-02-15</td>
                  <td>
                    <select class="in-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#ffb300;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기' selected>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="in-row-check"></td>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showInDetail('이미영', '20240802', '경영학과', '2학년', '010-2345-6789', '2024-03-05', '2024-02-18')">이미영</td>
                  <td>20240802</td>
                  <td>경영학과</td>
                  <td>2학년</td>
                  <td>010-2345-6789</td>
                  <td>2024-03-05</td>
                  <td>2024-02-18</td>
                  <td>
                    <select class="in-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#43a047;color:#fff;font-weight:600;border:none;'>
                      <option value='승인' selected>승인</option>
                      <option value='대기'>대기</option>
                      <option value='반려'>반려</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input type="checkbox" class="in-row-check"></td>
                  <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showInDetail('박준호', '20240803', '전자공학과', '1학년', '010-3456-7890', '2024-03-10', '2024-02-20')">박준호</td>
                  <td>20240803</td>
                  <td>전자공학과</td>
                  <td>1학년</td>
                  <td>010-3456-7890</td>
                  <td>2024-03-10</td>
                  <td>2024-02-20</td>
                  <td>
                    <select class="in-status-select" style='border-radius:12px;padding:4px 12px;font-size:1em;background:#d32f2f;color:#fff;font-weight:600;border:none;'>
                      <option value='승인'>승인</option>
                      <option value='대기'>대기</option>
                      <option value='반려' selected>반려</option>
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
            <div style="display:flex;justify-content:center;margin-top:18px;">
              <button id="in-confirm-btn" style="padding:12px 38px;font-size:1.1em;font-weight:700;border:none;border-radius:18px;background:#4d7bbd;color:#fff;box-shadow:0 2px 8px rgba(77,123,189,0.08);cursor:pointer;">확인하기</button>
            </div>
            <div style="padding:10px 18px 0 18px;color:#888;font-size:0.97em;">1-3 of 8 &nbsp; &nbsp; Rows per page: 10 <span style="font-size:1.2em;vertical-align:middle;">◀️ ▶️</span></div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script>
    // ===== Firebase 설정 =====
    const firebaseConfig = {
      apiKey: "AIzaSyALZObKyLk_Cik0H_qJ-IGBQUOR3hhlFko",
      authDomain: "univia-db582.firebaseapp.com",
      projectId: "univia-db582",
      storageBucket: "univia-db582.firebasestorage.app",
      messagingSenderId: "565193661532",
      appId: "1:565193661532:web:804f0fa8dcf2e05ef89a99"
    };

    // Firebase 초기화
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // 현재 로그인된 관리자 정보
    let currentAdmin = null;
    
    // 관리자 정보 업데이트 함수
    function updateAdminInfo() {
      const adminInfo = document.getElementById('admin-info');
      const adminName = document.getElementById('admin-name');
      
      if (currentAdmin) {
        adminInfo.style.display = 'block';
        let adminDisplayName = '';
        
        switch (currentAdmin.email) {
          case 'director@dormi.com':
            adminDisplayName = '실장님 (이민구)';
            break;
          case 'supervisor@dormi.com':
            adminDisplayName = '사감님 (김영희)';
            break;
          case 'floor_manager@dormi.com':
            adminDisplayName = '층장님 (박철수)';
            break;
          default:
            adminDisplayName = currentAdmin.email;
        }
        
        adminName.textContent = adminDisplayName;
        document.getElementById('current-admin-display').textContent = adminDisplayName;
      } else {
        adminInfo.style.display = 'none';
        document.getElementById('current-admin-display').textContent = '';
      }
    }
    
    // 테스트 데이터 생성 함수
    function createSampleChatData() {
      if (!currentAdmin) {
        alert('관리자로 로그인해주세요.');
        return;
      }
      
      console.log('테스트 데이터 생성 시작');
      console.log('현재 관리자:', currentAdmin.email);
      
      const students = [
        { name: '이승우', id: '20230709', major: '소프트웨어융합대학' },
        { name: '김지현', id: '20230627', major: '경영학과' },
        { name: '박민수', id: '20230528', major: '전자공학과' },
        { name: '최유진', id: '20230811', major: '컴퓨터공학과' }
      ];
      
      let adminType = '';
      switch (currentAdmin.email) {
        case 'director@dormi.com':
          adminType = 'director';
          break;
        case 'supervisor@dormi.com':
          adminType = 'supervisor';
          break;
        case 'floor_manager@dormi.com':
          adminType = 'floor_manager';
          break;
      }
      
      console.log('관리자 타입:', adminType);
      
      students.forEach((student, index) => {
        const chatId = `chat_${student.id}_${adminType}`;
        console.log('채팅방 ID 생성:', chatId);
        
        // 채팅방 생성 - chats 컬렉션 사용
        db.collection('chats').doc(chatId).set({
          studentName: student.name,
          studentId: student.id,
          participants: [student.id, 'admin'],
          adminType: adminType,
          lastMessage: `안녕하세요 ${student.name}님, 무엇을 도와드릴까요?`,
          lastMessageTime: firebase.firestore.Timestamp.now(),
          lastMessageBy: 'admin',
          updatedAt: firebase.firestore.Timestamp.now(),
          createdAt: firebase.firestore.Timestamp.now()
        }).then(() => {
          console.log(`채팅방 생성 성공: ${student.name}`);
          // 초기 메시지 추가
          return db.collection('chats').doc(chatId).collection('messages').add({
            text: `안녕하세요 ${student.name}님, 무엇을 도와드릴까요?`,
            senderId: 'admin',
            senderName: currentAdmin.email === 'director@dormi.com' ? '실장님' : 
                       currentAdmin.email === 'supervisor@dormi.com' ? '사감님' : '층장님',
            timestamp: firebase.firestore.Timestamp.now(),
            isAdmin: true
          });
        }).then(() => {
          console.log(`메시지 추가 완료: ${student.name}`);
        }).catch((error) => {
          console.error('채팅방 생성 오류:', error);
        });
      });
      
      setTimeout(() => {
        console.log('테스트 데이터 생성 완료, 목록 새로고침');
        showMessageList();
        alert('테스트 채팅 데이터가 생성되었습니다.');
      }, 2000);
    }
    
    // ===== 페이지 전환 함수들 =====
    // 메뉴 클릭 이벤트 설정 함수
    function setupMenuEventListeners() {
      // 회원 목록
      var memberListLink = document.getElementById('member-list-link');
      if (memberListLink) {
        memberListLink.onclick = function() {
          document.getElementById('dashboard-view').style.display = 'none';
          document.getElementById('member-view').style.display = 'block';
          document.getElementById('dorm-apply-view').style.display = 'none';
          document.getElementById('dorm-leave-view').style.display = 'none';
          document.getElementById('complaint-view').style.display = 'none';
          document.getElementById('point-view').style.display = 'none';
          document.getElementById('dorm-out-view').style.display = 'none';
          document.getElementById('dorm-in-view').style.display = 'none';
          document.getElementById('notice-view').style.display = 'none';
          document.getElementById('message-view').style.display = 'none';
          document.getElementById('schedule-view').style.display = 'none';
        };
      }
      
      // 민원 관리
      var complaintLink = document.getElementById('complaint-link');
      if (complaintLink) {
        complaintLink.onclick = function() {
          document.getElementById('dashboard-view').style.display = 'none';
          document.getElementById('member-view').style.display = 'none';
          document.getElementById('dorm-apply-view').style.display = 'none';
          document.getElementById('dorm-leave-view').style.display = 'none';
          document.getElementById('complaint-view').style.display = 'block';
          document.getElementById('point-view').style.display = 'none';
          document.getElementById('dorm-out-view').style.display = 'none';
          document.getElementById('dorm-in-view').style.display = 'none';
          document.getElementById('notice-view').style.display = 'none';
          document.getElementById('message-view').style.display = 'none';
          document.getElementById('schedule-view').style.display = 'none';
          setTimeout(initComplaintSelectColors, 10);
        };
      }
      
      // 상벌점 관리
      var pointLink = document.getElementById('point-link');
      if (pointLink) {
        pointLink.onclick = function() {
          document.getElementById('dashboard-view').style.display = 'none';
          document.getElementById('member-view').style.display = 'none';
          document.getElementById('dorm-apply-view').style.display = 'none';
          document.getElementById('dorm-leave-view').style.display = 'none';
          document.getElementById('complaint-view').style.display = 'none';
          document.getElementById('point-view').style.display = 'block';
          document.getElementById('notice-view').style.display = 'none';
          document.getElementById('schedule-view').style.display = 'none';
          document.getElementById('dorm-out-view').style.display = 'none';
          document.getElementById('dorm-in-view').style.display = 'none';
          document.getElementById('message-view').style.display = 'none';
          setTimeout(initPointSelectColors, 10);
        };
      }
      
      // 공지사항 관리
      var noticeLink = document.getElementById('notice-link');
      if (noticeLink) {
        noticeLink.onclick = function() {
          document.getElementById('dashboard-view').style.display = 'none';
          document.getElementById('member-view').style.display = 'none';
          document.getElementById('dorm-apply-view').style.display = 'none';
          document.getElementById('dorm-leave-view').style.display = 'none';
          document.getElementById('complaint-view').style.display = 'none';
          document.getElementById('point-view').style.display = 'none';
          document.getElementById('notice-view').style.display = 'block';
          document.getElementById('schedule-view').style.display = 'none';
          document.getElementById('dorm-out-view').style.display = 'none';
          document.getElementById('dorm-in-view').style.display = 'none';
          document.getElementById('message-view').style.display = 'none';
        };
      }
      
      // 메시지 관리
      var messageLink = document.getElementById('message-link');
      if (messageLink) {
        messageLink.onclick = function() {
          document.getElementById('dashboard-view').style.display = 'none';
          document.getElementById('member-view').style.display = 'none';
          document.getElementById('dorm-apply-view').style.display = 'none';
          document.getElementById('dorm-leave-view').style.display = 'none';
          document.getElementById('complaint-view').style.display = 'none';
          document.getElementById('point-view').style.display = 'none';
          document.getElementById('notice-view').style.display = 'none';
          document.getElementById('schedule-view').style.display = 'none';
          document.getElementById('dorm-out-view').style.display = 'none';
          document.getElementById('dorm-in-view').style.display = 'none';
          document.getElementById('message-view').style.display = 'block';
          setTimeout(showMessageList, 10);
        };
      }
      
      // 일정관리
      var scheduleLink = document.getElementById('schedule-link');
      if (scheduleLink) {
        scheduleLink.onclick = function() {
          document.getElementById('dashboard-view').style.display = 'none';
          document.getElementById('member-view').style.display = 'none';
          document.getElementById('dorm-apply-view').style.display = 'none';
          document.getElementById('dorm-leave-view').style.display = 'none';
          document.getElementById('complaint-view').style.display = 'none';
          document.getElementById('point-view').style.display = 'none';
          document.getElementById('notice-view').style.display = 'none';
          document.getElementById('schedule-view').style.display = 'block';
          document.getElementById('message-view').style.display = 'none';
          document.getElementById('dorm-out-view').style.display = 'none';
          document.getElementById('dorm-in-view').style.display = 'none';
          setTimeout(initCalendar, 10);
        };
      }
      
      // 외박 신청 관리
      var dormLeaveLink = document.getElementById('dorm-leave-link');
      if (dormLeaveLink) {
        dormLeaveLink.onclick = function() {
          document.getElementById('dashboard-view').style.display = 'none';
          document.getElementById('member-view').style.display = 'none';
          document.getElementById('dorm-apply-view').style.display = 'none';
          document.getElementById('dorm-leave-view').style.display = 'block';
          document.getElementById('complaint-view').style.display = 'none';
          document.getElementById('point-view').style.display = 'none';
          document.getElementById('notice-view').style.display = 'none';
          document.getElementById('schedule-view').style.display = 'none';
          document.getElementById('dorm-out-view').style.display = 'none';
          document.getElementById('dorm-in-view').style.display = 'none';
          document.getElementById('message-view').style.display = 'none';
          setTimeout(initLeaveSelectColors, 10);
        };
      }
          // 퇴사 신청 관리
      document.querySelectorAll('li').forEach(function(li) {
        if (li.textContent.trim() === '퇴사 신청 관리') {
          li.onclick = function() {
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('member-view').style.display = 'none';
            document.getElementById('dorm-apply-view').style.display = 'none';
            document.getElementById('dorm-leave-view').style.display = 'none';
            document.getElementById('complaint-view').style.display = 'none';
            document.getElementById('point-view').style.display = 'none';
            document.getElementById('notice-view').style.display = 'none';
            document.getElementById('schedule-view').style.display = 'none';
            document.getElementById('dorm-out-view').style.display = 'block';
            document.getElementById('dorm-in-view').style.display = 'none';
            document.getElementById('message-view').style.display = 'none';
            setTimeout(initOutSelectColors, 10);
          }
        }
      });
      
      // 입사 신청 관리
      var dormInLink = document.getElementById('dorm-in-link');
      if (dormInLink) {
        dormInLink.onclick = function() {
          document.getElementById('dashboard-view').style.display = 'none';
          document.getElementById('member-view').style.display = 'none';
          document.getElementById('dorm-apply-view').style.display = 'none';
          document.getElementById('dorm-leave-view').style.display = 'none';
          document.getElementById('complaint-view').style.display = 'none';
          document.getElementById('point-view').style.display = 'none';
          document.getElementById('notice-view').style.display = 'none';
          document.getElementById('schedule-view').style.display = 'none';
          document.getElementById('dorm-out-view').style.display = 'none';
          document.getElementById('message-view').style.display = 'none';
          document.getElementById('dorm-in-view').style.display = 'block';
          setTimeout(initInSelectColors, 10);
        };
      }
    }
    // Dormi 로고 클릭 시 대시보드로 이동
    document.getElementById('dashboard-logo').onclick = showDashboard;
    document.getElementById('dashboard-title').onclick = showDashboard;
    // 통계 업데이트 함수
    function updateDashboardStats() {
      // 전체 학생 인원 (회원 관리 테이블에 실제 표시된 학생 수)
      var memberRows = document.querySelectorAll('#member-view table tbody tr');
      var totalStudents = memberRows.length; // 실제 표시된 학생 수 (5명)
      document.getElementById('total-students').textContent = totalStudents;
      
      // 미처리 신청 건수 (showPendingApplications 함수에서 계산된 실제 건수)
      var pendingCount = 0;
      
      // 외박 신청 관리에서 대기 상태 항목들
      var dormApplyRows = document.querySelectorAll('#dorm-apply-table tbody tr');
      dormApplyRows.forEach(function(row) {
        var statusSelect = row.querySelector('select');
        if (statusSelect && statusSelect.value === '대기') {
          pendingCount++;
        }
      });
      
      // 민원 관리에서 대기 상태 항목들
      var complaintRows = document.querySelectorAll('#complaint-table tbody tr');
      complaintRows.forEach(function(row) {
        var statusSelect = row.querySelector('select');
        if (statusSelect && statusSelect.value === '대기') {
          pendingCount++;
        }
      });
      
      // 퇴사 신청 관리에서 대기 상태 항목들
      var dormLeaveRows = document.querySelectorAll('#dorm-leave-table tbody tr');
      dormLeaveRows.forEach(function(row) {
        var statusSelect = row.querySelector('select');
        if (statusSelect && statusSelect.value === '대기') {
          pendingCount++;
        }
      });
      
      document.getElementById('pending-applications-count').textContent = pendingCount;
      
      // 새로운 메시지 건수 (로그인한 관리자와의 채팅에서 학생이 마지막 메시지를 보낸 채팅방 수)
      var newMessagesCount = 0;
      
      // 현재 로그인된 관리자 타입 확인
      let currentAdminType = '';
      if (currentAdmin) {
        switch (currentAdmin.email) {
          case 'director@dormi.com':
            currentAdminType = 'director';
            break;
          case 'supervisor@dormi.com':
            currentAdminType = 'supervisor';
            break;
          case 'floor_manager@dormi.com':
            currentAdminType = 'floor_manager';
            break;
          default:
            currentAdminType = 'all';
        }
      }
      
      // Firestore에서 실시간으로 새 메시지 수 계산 (로그인한 관리자에 맞는 채팅만)
      let query = db.collection('chats').where('lastMessageBy', '==', 'student');
      
      if (currentAdminType !== 'all') {
        query = query.where('adminType', '==', currentAdminType);
      }
      
      query.get()
        .then((snapshot) => {
          newMessagesCount = snapshot.size;
          document.getElementById('new-messages-count').textContent = newMessagesCount;
        })
        .catch((error) => {
          console.error('새 메시지 수 계산 오류:', error);
          document.getElementById('new-messages-count').textContent = '0';
        });
    }
    
    // 대기 상태 신청 목록 표시 함수
    function showPendingApplications() {
      var pendingContainer = document.getElementById('pending-applications');
      pendingContainer.innerHTML = '';
      
      // 외박 신청 관리에서 대기 상태 항목들
      var dormApplyRows = document.querySelectorAll('#dorm-apply-table tbody tr');
      var pendingDormApply = [];
      
      dormApplyRows.forEach(function(row) {
        var statusSelect = row.querySelector('select');
        if (statusSelect && statusSelect.value === '대기') {
          var name = row.children[0].textContent;
          var studentId = row.children[1].textContent;
          var major = row.children[2].textContent;
          var gender = row.children[3].textContent;
          var room = row.children[4].textContent;
          var reason = row.children[5].textContent;
          
          pendingDormApply.push({
            type: '외박 신청',
            name: name,
            studentId: studentId,
            major: major,
            gender: gender,
            room: room,
            reason: reason
          });
        }
      });
      
      // 민원 관리에서 대기 상태 항목들
      var complaintRows = document.querySelectorAll('#complaint-table tbody tr');
      var pendingComplaint = [];
      
      complaintRows.forEach(function(row) {
        var statusSelect = row.querySelector('select');
        if (statusSelect && statusSelect.value === '대기') {
          var name = row.children[0].textContent;
          var studentId = row.children[1].textContent;
          var major = row.children[2].textContent;
          var gender = row.children[3].textContent;
          var title = row.children[4].textContent;
          
          pendingComplaint.push({
            type: '민원',
            name: name,
            studentId: studentId,
            major: major,
            gender: gender,
            title: title
          });
        }
      });
      
      // 퇴사 신청 관리에서 대기 상태 항목들
      var dormLeaveRows = document.querySelectorAll('#dorm-leave-table tbody tr');
      var pendingDormLeave = [];
      
      dormLeaveRows.forEach(function(row) {
        var statusSelect = row.querySelector('select');
        if (statusSelect && statusSelect.value === '대기') {
          var name = row.children[0].textContent;
          var studentId = row.children[1].textContent;
          var major = row.children[2].textContent;
          var gender = row.children[3].textContent;
          var room = row.children[4].textContent;
          var reason = row.children[5].textContent;
          
          pendingDormLeave.push({
            type: '퇴사 신청',
            name: name,
            studentId: studentId,
            major: major,
            gender: gender,
            room: room,
            reason: reason
          });
        }
      });
      
      // 모든 대기 상태 항목 합치기
      var allPending = [...pendingDormApply, ...pendingComplaint, ...pendingDormLeave];
      
      if (allPending.length === 0) {
        pendingContainer.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">대기 상태의 신청이 없습니다.</div>';
        return;
      }
      
      // 대기 상태 항목들 표시
      allPending.forEach(function(item, index) {
        var itemElement = document.createElement('div');
        itemElement.style.cssText = 'display:flex;align-items:center;padding:12px;border-radius:8px;background:#f8f9fa;border-left:4px solid #ff9800;margin-bottom:8px;cursor:pointer;';
        
        var typeColor = item.type === '외박 신청' ? '#4d7bbd' : item.type === '민원' ? '#d32f2f' : '#43a047';
        
        itemElement.innerHTML = `
          <div style="flex:1;">
            <div style="font-weight:600;color:#333;margin-bottom:4px;">${item.name} (${item.studentId})</div>
            <div style="font-size:0.9em;color:#666;margin-bottom:2px;">${item.major} | ${item.gender}</div>
            <div style="font-size:0.9em;color:#666;">${item.type === '민원' ? '민원 제목: ' + item.title : '사유: ' + item.reason}</div>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
            <span style="background:${typeColor};color:#fff;padding:4px 8px;border-radius:12px;font-size:0.8em;font-weight:600;">${item.type}</span>
            <span style="background:#ff9800;color:#fff;padding:4px 8px;border-radius:12px;font-size:0.8em;">대기</span>
          </div>
        `;
        
        // 클릭 이벤트 추가
        itemElement.addEventListener('click', function() {
          if (item.type === '외박 신청') {
            // 외박 신청 관리 페이지로 이동
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('member-view').style.display = 'none';
            document.getElementById('dorm-apply-view').style.display = 'block';
            document.getElementById('dorm-leave-view').style.display = 'none';
            document.getElementById('complaint-view').style.display = 'none';
            document.getElementById('point-view').style.display = 'none';
            document.getElementById('notice-view').style.display = 'none';
            document.getElementById('schedule-view').style.display = 'none';
            document.getElementById('dorm-out-view').style.display = 'none';
          } else if (item.type === '민원') {
            // 민원 관리 페이지로 이동
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('member-view').style.display = 'none';
            document.getElementById('dorm-apply-view').style.display = 'none';
            document.getElementById('dorm-leave-view').style.display = 'none';
            document.getElementById('complaint-view').style.display = 'block';
            document.getElementById('point-view').style.display = 'none';
            document.getElementById('notice-view').style.display = 'none';
            document.getElementById('schedule-view').style.display = 'none';
            document.getElementById('dorm-out-view').style.display = 'none';
          } else if (item.type === '퇴사 신청') {
            // 퇴사 신청 관리 페이지로 이동
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('member-view').style.display = 'none';
            document.getElementById('dorm-apply-view').style.display = 'none';
            document.getElementById('dorm-leave-view').style.display = 'block';
            document.getElementById('complaint-view').style.display = 'none';
            document.getElementById('point-view').style.display = 'none';
            document.getElementById('notice-view').style.display = 'none';
            document.getElementById('schedule-view').style.display = 'none';
            document.getElementById('dorm-out-view').style.display = 'none';
          }
        });
        
        // 호버 효과 추가
        itemElement.addEventListener('mouseenter', function() {
          this.style.backgroundColor = '#e3f2fd';
          this.style.transform = 'translateY(-1px)';
          this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
        });
        
        itemElement.addEventListener('mouseleave', function() {
          this.style.backgroundColor = '#f8f9fa';
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = 'none';
        });
        
        pendingContainer.appendChild(itemElement);
      });
    }
    
    function showDashboard() {
      document.getElementById('dashboard-view').style.display = 'block';
      document.getElementById('member-view').style.display = 'none';
      document.getElementById('dorm-apply-view').style.display = 'none';
      document.getElementById('dorm-leave-view').style.display = 'none';
      document.getElementById('complaint-view').style.display = 'none';
      document.getElementById('point-view').style.display = 'none';
      document.getElementById('notice-view').style.display = 'none';
      document.getElementById('schedule-view').style.display = 'none';
      document.getElementById('message-view').style.display = 'none';
      document.getElementById('dorm-out-view').style.display = 'none';
      document.getElementById('dorm-in-view').style.display = 'none';
      setTimeout(function() {
        updateDashboardStats();
        showWeeklySchedule();
        showPendingApplications();
      }, 100);
    }
    
    // ===== 메시지 관리 관련 =====
    // 메시지 데이터
    var messages = [
      {
        id: 1,
        studentName: '이승우',
        studentId: '20230709',
        subject: '기숙사 규정 문의',
        lastMessage: '기숙사 내 음식 반입에 대해 문의드립니다.',
        timestamp: '2024-01-15 14:30',
        unread: true
      },
      {
        id: 2,
        studentName: '김지현',
        studentId: '20230627',
        subject: '시설물 고장 신고',
        lastMessage: '화장실 수도관에서 물이 새고 있습니다.',
        timestamp: '2024-01-14 16:45',
        unread: false
      },
      {
        id: 3,
        studentName: '박민수',
        studentId: '20230528',
        subject: '외박 신청 관련',
        lastMessage: '외박 신청이 승인되었습니다.',
        timestamp: '2024-01-13 09:20',
        unread: false
      }
    ];
    
    // 실시간 채팅 목록 표시 함수
    function showMessageList() {
      var chatList = document.getElementById('chat-list');
      if (!chatList) {
        console.error('채팅 목록 요소를 찾을 수 없습니다.');
        return;
      }
      
      console.log('채팅 목록 표시 시작');
      chatList.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">채팅 목록을 불러오는 중...</div>';
      
      // 현재 로그인된 관리자 타입 확인
      let currentAdminType = '';
      if (currentAdmin) {
        switch (currentAdmin.email) {
          case 'director@dormi.com':
            currentAdminType = 'director';
            break;
          case 'supervisor@dormi.com':
            currentAdminType = 'supervisor';
            break;
          case 'floor_manager@dormi.com':
            currentAdminType = 'floor_manager';
            break;
          default:
            currentAdminType = 'all';
        }
      }
      
      console.log('현재 관리자 타입:', currentAdminType);
      console.log('현재 관리자 정보:', currentAdmin);
      
      // 로그인한 관리자에 맞는 채팅만 필터링 - chats 컬렉션 사용
      let query = db.collection('chats');
      
      // 임시로 모든 채팅방 표시 (디버깅용)
      console.log('모든 채팅방 표시 (디버깅)');
      
      // if (currentAdminType !== 'all' && currentAdminType !== '') {
      //   query = query.where('adminType', '==', currentAdminType);
      //   console.log('관리자 타입 필터 적용:', currentAdminType);
      // } else {
      //   console.log('모든 채팅방 표시');
      // }
      
      query.orderBy('updatedAt', 'desc')
        .onSnapshot((snapshot) => {
          console.log('🔥 실시간 채팅 데이터 수신:', snapshot.size, '개 채팅방');
          const chats = [];
          snapshot.forEach((doc) => {
            const data = doc.data();
            console.log('📋 채팅방 데이터:', doc.id, data);
            // 모든 채팅방 표시 (디버깅용)
            console.log('✅ 채팅방 데이터:', doc.id, data);
            
            // 마지막 메시지 시간 처리
            let lastMessageTime = '';
            if (data.lastMessageTime) {
              try {
                lastMessageTime = new Date(data.lastMessageTime.toDate()).toLocaleString();
              } catch (e) {
                lastMessageTime = new Date().toLocaleString();
              }
            }
            
            chats.push({
              chatId: doc.id,
              studentName: data.studentName || '알 수 없는 사용자',
              studentId: data.studentId || 'unknown',
              lastMessage: data.lastMessage || '메시지가 없습니다.',
              lastMessageTime: lastMessageTime,
              lastMessageBy: data.lastMessageBy || 'student',
              adminType: data.adminType || 'general',
              unread: data.lastMessageBy === 'student' // 학생이 마지막 메시지를 보낸 경우 읽지 않은 것으로 표시
            });
          });
          
          console.log('📊 표시할 채팅 목록:', chats);
          displayChatList(chats);
        }, (error) => {
          console.error('채팅 목록 로드 오류:', error);
          chatList.innerHTML = '<div style="text-align:center;color:#d32f2f;padding:20px;">채팅 목록을 불러오는데 실패했습니다.<br>오류: ' + error.message + '</div>';
        });
    }
    
    // 채팅 목록 표시 함수
    function displayChatList(chats) {
      var chatList = document.getElementById('chat-list');
      if (!chatList) {
        console.error('채팅 목록 요소를 찾을 수 없습니다.');
        return;
      }
      
      console.log('채팅 목록 표시:', chats);
      console.log('채팅 개수:', chats.length);
      
      if (chats.length === 0) {
        chatList.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">채팅이 없습니다.<br>앱에서 메시지를 보내면 여기에 표시됩니다.<br><br>현재 관리자: ' + (currentAdmin ? currentAdmin.email : '로그인되지 않음') + '</div>';
        return;
      }
      
      chatList.innerHTML = '';
      
      chats.forEach(function(chat) {
        var chatElement = document.createElement('div');
        chatElement.style.cssText = 'display:flex;align-items:center;padding:16px;border-radius:8px;background:#f8f9fa;border-left:4px solid #4d7bbd;cursor:pointer;margin-bottom:8px;transition:all 0.2s;';
        
        if (chat.unread) {
          chatElement.style.borderLeftColor = '#d32f2f';
          chatElement.style.backgroundColor = '#fff3e0';
        }
        
        // 관리자 타입에 따른 색상 설정
        let adminTypeColor = '#4d7bbd';
        let adminTypeText = '';
        switch (chat.adminType) {
          case 'director':
            adminTypeColor = '#1976d2';
            adminTypeText = '실장님';
            break;
          case 'supervisor':
            adminTypeColor = '#388e3c';
            adminTypeText = '사감님';
            break;
          case 'floor_manager':
            adminTypeColor = '#f57c00';
            adminTypeText = '층장님';
            break;
          case 'chatbot':
            adminTypeColor = '#7b1fa2';
            adminTypeText = '쳇봇';
            break;
        }
        
        chatElement.innerHTML = `
          <div style="flex:1;">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
              <div style="font-weight:600;color:#333;">${chat.studentName} (${chat.studentId})</div>
              <span style="background:${adminTypeColor};color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;">${adminTypeText}</span>
              ${chat.unread ? '<span style="background:#d32f2f;color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;">새</span>' : ''}
            </div>
            <div style="font-size:0.9em;color:#666;">${chat.lastMessage}</div>
            <div style="font-size:0.8em;color:#999;margin-top:2px;">${chat.lastMessageTime}</div>
          </div>
          <div style="text-align:right;font-size:0.8em;color:#888;">
            <div style="margin-bottom:4px;">${chat.lastMessageBy === 'student' ? '학생' : '관리자'}</div>
            <div>${chat.lastMessageTime}</div>
          </div>
        `;
        
        chatElement.addEventListener('click', function() {
          console.log('채팅방 클릭:', chat.chatId);
          openChatDetail(chat);
        });
        
        chatElement.addEventListener('mouseenter', function() {
          this.style.backgroundColor = '#e3f2fd';
        });
        
        chatElement.addEventListener('mouseleave', function() {
          if (chat.unread) {
            this.style.backgroundColor = '#fff3e0';
          } else {
            this.style.backgroundColor = '#f8f9fa';
          }
        });
        
        chatList.appendChild(chatElement);
      });
    }
    
    // 채팅 상세보기 함수
    function openChatDetail(chat) {
      var modalHtml = `
        <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;">
          <div style="background:#fff;border-radius:12px;padding:24px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
              <h3 style="margin:0;color:#333;">${chat.studentName} (${chat.studentId})</h3>
              <button onclick="closeChatDetail()" style="background:none;border:none;font-size:1.5em;cursor:pointer;color:#666;">×</button>
            </div>
            <div style="margin-bottom:16px;padding:12px;background:#f8f9fa;border-radius:8px;">
              <div style="font-weight:600;color:#333;">학생과의 실시간 채팅</div>
              <div style="font-size:0.9em;color:#666;">마지막 메시지: ${chat.lastMessageTime}</div>
            </div>
            <div id="chat-conversation" style="margin-bottom:20px;max-height:400px;overflow-y:auto;border:1px solid #eee;border-radius:8px;padding:12px;background:#fafafa;">
              <!-- 실시간 채팅 내용 -->
            </div>
            <div style="display:flex;gap:8px;">
              <input type="text" id="chat-reply-input" placeholder="메시지를 입력하세요..." style="flex:1;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
              <button onclick="sendChatReply('${chat.chatId}')" style="padding:8px 16px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;">전송</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // 실시간 채팅 내용 로드
      loadChatMessages(chat.chatId);
      
      // 엔터키로 메시지 전송
      document.getElementById('chat-reply-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendChatReply(chat.chatId);
        }
      });
    }
    
    // 채팅 메시지 로드 함수
    function loadChatMessages(chatId) {
      const conversationDiv = document.getElementById('chat-conversation');
      if (!conversationDiv) return;
      
      console.log('채팅방 메시지 로드 시작:', chatId);
      conversationDiv.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">메시지를 불러오는 중...</div>';
      
      // Firestore에서 실시간으로 메시지 구독 - chats 컬렉션 사용
      db.collection('chats').doc(chatId).collection('messages')
        .orderBy('timestamp', 'asc')
        .onSnapshot((snapshot) => {
          console.log('📨 메시지 스트림 수신:', snapshot.size, '개 메시지');
          const messages = [];
          snapshot.forEach((doc) => {
            const data = doc.data();
            console.log('📝 메시지 데이터:', data);
            messages.push({
              id: doc.id,
              text: data.text || '',
              senderId: data.senderId || '',
              senderName: data.senderName || '',
              timestamp: data.timestamp ? new Date(data.timestamp.toDate()).toLocaleString() : '',
              isAdmin: data.isAdmin || false
            });
          });
          
          console.log('📊 표시할 메시지:', messages);
          displayChatMessages(messages);
        }, (error) => {
          console.error('채팅 메시지 로드 오류:', error);
          conversationDiv.innerHTML = '<div style="text-align:center;color:#d32f2f;padding:20px;">메시지를 불러오는데 실패했습니다.<br>오류: ' + error.message + '</div>';
        });
    }
    
    // 채팅 메시지 표시 함수
    function displayChatMessages(messages) {
      const conversationDiv = document.getElementById('chat-conversation');
      if (!conversationDiv) return;
      
      console.log('메시지 표시:', messages);
      
      if (messages.length === 0) {
        conversationDiv.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">메시지가 없습니다.<br>앱에서 메시지를 보내면 여기에 표시됩니다.</div>';
        return;
      }
      
      conversationDiv.innerHTML = '';
      
      messages.forEach(function(msg) {
        const messageElement = document.createElement('div');
        messageElement.style.cssText = 'margin-bottom:12px;';
        
        if (msg.isAdmin) {
          // 관리자 메시지 (오른쪽 정렬)
          messageElement.innerHTML = `
            <div style="display:flex;justify-content:flex-end;">
              <div style="background:#4d7bbd;color:#fff;padding:8px 12px;border-radius:12px;max-width:70%;">
                <div style="margin-bottom:4px;font-weight:500;">${msg.text}</div>
                <div style="font-size:0.8em;opacity:0.8;">${msg.timestamp}</div>
              </div>
            </div>
          `;
        } else {
          // 학생 메시지 (왼쪽 정렬)
          messageElement.innerHTML = `
            <div style="display:flex;justify-content:flex-start;">
              <div style="background:#f1f3f4;color:#333;padding:8px 12px;border-radius:12px;max-width:70%;">
                <div style="margin-bottom:4px;font-weight:500;">${msg.text}</div>
                <div style="font-size:0.8em;opacity:0.8;">${msg.timestamp}</div>
              </div>
            </div>
          `;
        }
        
        conversationDiv.appendChild(messageElement);
      });
      
      // 스크롤을 맨 아래로 이동
      conversationDiv.scrollTop = conversationDiv.scrollHeight;
    }
    
    // 채팅 답변 전송 함수
    function sendChatReply(chatId) {
      const replyInput = document.getElementById('chat-reply-input');
      const reply = replyInput.value.trim();
      
      if (!reply) {
        alert('메시지를 입력해주세요.');
        return;
      }
      
      if (!currentAdmin) {
        alert('관리자로 로그인해주세요.');
        return;
      }
      
      console.log('관리자 메시지 전송 시작:', reply);
      
      // 관리자 메시지 전송
      const message = {
        text: reply,
        senderId: 'admin',
        senderName: currentAdmin.email === 'director@dormi.com' ? '실장님' : 
                   currentAdmin.email === 'supervisor@dormi.com' ? '사감님' : 
                   currentAdmin.email === 'floor_manager@dormi.com' ? '층장님' : '관리자',
        timestamp: firebase.firestore.Timestamp.now(),
        isAdmin: true
      };
      
      db.collection('chats').doc(chatId).collection('messages').add(message)
        .then(() => {
          console.log('메시지 저장 성공');
          // 채팅방 정보 업데이트
          return db.collection('chats').doc(chatId).set({
            lastMessage: reply,
            lastMessageTime: firebase.firestore.Timestamp.now(),
            lastMessageBy: 'admin',
            updatedAt: firebase.firestore.Timestamp.now()
          }, { merge: true });
        })
        .then(() => {
          replyInput.value = '';
          console.log('관리자 메시지 전송 성공');
        })
        .catch((error) => {
          console.error('메시지 전송 오류:', error);
          alert('메시지 전송에 실패했습니다.');
        });
    }
    
    // 채팅 상세보기 닫기 함수
    function closeChatDetail() {
      const modal = document.querySelector('div[style*="position:fixed"]');
      if (modal) modal.remove();
    }
    
    // 대화 내용 표시 함수
    function showConversation(message) {
      var conversationDiv = document.getElementById('message-conversation');
      conversationDiv.innerHTML = '';
      
      // 샘플 대화 내용
      var conversation = [
        { sender: 'student', message: message.lastMessage, time: message.timestamp },
        { sender: 'admin', message: '안녕하세요. 문의해주신 내용에 대해 답변드리겠습니다.', time: '2024-01-15 15:00' },
        { sender: 'student', message: '감사합니다. 추가로 궁금한 점이 있습니다.', time: '2024-01-15 15:30' }
      ];
      
      conversation.forEach(function(msg) {
        var messageElement = document.createElement('div');
        messageElement.style.cssText = 'margin-bottom:12px;';
        
        if (msg.sender === 'admin') {
          messageElement.innerHTML = `
            <div style="display:flex;justify-content:flex-end;">
              <div style="background:#4d7bbd;color:#fff;padding:8px 12px;border-radius:12px;max-width:70%;">
                <div style="margin-bottom:4px;">${msg.message}</div>
                <div style="font-size:0.8em;opacity:0.8;">${msg.time}</div>
              </div>
            </div>
          `;
        } else {
          messageElement.innerHTML = `
            <div style="display:flex;justify-content:flex-start;">
              <div style="background:#f1f3f4;color:#333;padding:8px 12px;border-radius:12px;max-width:70%;">
                <div style="margin-bottom:4px;">${msg.message}</div>
                <div style="font-size:0.8em;opacity:0.8;">${msg.time}</div>
              </div>
            </div>
          `;
        }
        
        conversationDiv.appendChild(messageElement);
      });
      
      conversationDiv.scrollTop = conversationDiv.scrollHeight;
    }
    
    // 답변 전송 함수
    function sendReply() {
      var replyInput = document.getElementById('reply-input');
      var reply = replyInput.value.trim();
      
      if (!reply) {
        alert('답변을 입력해주세요.');
        return;
      }
      
      var conversationDiv = document.getElementById('message-conversation');
      var messageElement = document.createElement('div');
      messageElement.style.cssText = 'margin-bottom:12px;';
      
      var now = new Date();
      var timeString = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(now.getDate()).padStart(2, '0') + ' ' + String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0');
      
      messageElement.innerHTML = `
        <div style="display:flex;justify-content:flex-end;">
          <div style="background:#4d7bbd;color:#fff;padding:8px 12px;border-radius:12px;max-width:70%;">
            <div style="margin-bottom:4px;">${reply}</div>
            <div style="font-size:0.8em;opacity:0.8;">${timeString}</div>
          </div>
        </div>
      `;
      
      conversationDiv.appendChild(messageElement);
      conversationDiv.scrollTop = conversationDiv.scrollHeight;
      
      replyInput.value = '';
    }
    
    // 메시지 상세보기 닫기 함수
    function closeMessageDetail() {
      var modal = document.querySelector('div[style*="position:fixed"]');
      if (modal) modal.remove();
    }
    
    // 새 메시지 작성 함수
    function showNewMessageForm() {
      var modalHtml = `
        <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;">
          <div style="background:#fff;border-radius:12px;padding:24px;width:90%;max-width:500px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
              <h3 style="margin:0;color:#333;">새 메시지 작성</h3>
              <button onclick="closeNewMessageForm()" style="background:none;border:none;font-size:1.5em;cursor:pointer;color:#666;">×</button>
            </div>
            <div style="display:grid;gap:16px;">
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">학생 검색</label>
                <input type="text" id="new-message-student-search" placeholder="학생 이름을 검색하세요" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
                <div id="student-search-results" style="margin-top:8px;max-height:200px;overflow-y:auto;border:1px solid #ddd;border-radius:8px;display:none;">
                  <div class="student-option" data-value="고다현|20230709" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;" onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'" onclick="selectStudent('고다현|20230709')">고다현 (20230709)</div>
                  <div class="student-option" data-value="노홍철|20230627" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;" onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'" onclick="selectStudent('노홍철|20230627')">노홍철 (20230627)</div>
                  <div class="student-option" data-value="이하준|20230528" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;" onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'" onclick="selectStudent('이하준|20230528')">이하준 (20230528)</div>
                  <div class="student-option" data-value="이승우|20230709" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;" onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'" onclick="selectStudent('이승우|20230709')">이승우 (20230709)</div>
                  <div class="student-option" data-value="김지현|20230627" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;" onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'" onclick="selectStudent('김지현|20230627')">김지현 (20230627)</div>
                  <div class="student-option" data-value="박민수|20230528" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;" onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'" onclick="selectStudent('박민수|20230528')">박민수 (20230528)</div>
                  <div class="student-option" data-value="최유진|20230811" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;" onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'" onclick="selectStudent('최유진|20230811')">최유진 (20230811)</div>
                </div>
              </div>
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">내용</label>
                <textarea id="new-message-content" placeholder="메시지 내용을 입력하세요" rows="4" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;resize:vertical;"></textarea>
              </div>
            </div>
            <div style="display:flex;gap:8px;margin-top:20px;">
              <button onclick="closeNewMessageForm()" style="flex:1;padding:8px 16px;font-size:1rem;font-weight:600;border:1px solid #ddd;border-radius:8px;background:#fff;color:#666;cursor:pointer;">취소</button>
              <button onclick="sendNewMessage()" style="flex:1;padding:8px 16px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;">전송</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // 학생 검색 기능 추가
      var searchInput = document.getElementById('new-message-student-search');
      var searchResults = document.getElementById('student-search-results');
      
      searchInput.addEventListener('input', function() {
        var searchTerm = this.value.toLowerCase();
        var options = searchResults.querySelectorAll('.student-option');
        
        if (searchTerm.length > 0) {
          searchResults.style.display = 'block';
          options.forEach(function(option) {
            var text = option.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
              option.style.display = 'block';
            } else {
              option.style.display = 'none';
            }
          });
        } else {
          searchResults.style.display = 'none';
        }
      });
    }
    
    // 학생 선택 함수
    function selectStudent(studentValue) {
      var searchInput = document.getElementById('new-message-student-search');
      var searchResults = document.getElementById('student-search-results');
      
      searchInput.value = studentValue.split('|')[0] + ' (' + studentValue.split('|')[1] + ')';
      searchInput.setAttribute('data-selected', studentValue);
      searchResults.style.display = 'none';
    }
    
    // 새 메시지 전송 함수
    function sendNewMessage() {
      var searchInput = document.getElementById('new-message-student-search');
      var content = document.getElementById('new-message-content').value;
      
      if (!searchInput.getAttribute('data-selected') || !content) {
        alert('학생을 선택하고 내용을 입력해주세요.');
        return;
      }
      
      var studentInfo = searchInput.getAttribute('data-selected').split('|');
      var studentName = studentInfo[0];
      var studentId = studentInfo[1];
      
      var now = new Date();
      var timeString = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(now.getDate()).padStart(2, '0') + ' ' + String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0');
      
      var newMessage = {
        id: messages.length + 1,
        studentName: studentName,
        studentId: studentId,
        subject: '메시지',
        lastMessage: content,
        timestamp: timeString,
        unread: false
      };
      
      messages.unshift(newMessage);
      showMessageList();
      closeNewMessageForm();
    }
    
    // 새 메시지 폼 닫기 함수
    function closeNewMessageForm() {
      var modal = document.querySelector('div[style*="position:fixed"]');
      if (modal) modal.remove();
    }
    
    // 새로고침 버튼 이벤트
    var refreshChatsBtn = document.getElementById('refresh-chats-btn');
    if (refreshChatsBtn) {
      refreshChatsBtn.onclick = function() {
        showMessageList();
      };
    }
    
    // ===== 초기화 및 이벤트 리스너 =====
    // 페이지 로드 시 로그인 상태 확인 후 대시보드 표시
    window.onload = function() {
      // 메뉴 이벤트 리스너 설정
      setupMenuEventListeners();
      
      // 로그인 상태 확인
      auth.onAuthStateChanged(function(user) {
        if (user) {
          currentAdmin = user;
          console.log('관리자 로그인 확인:', user.email);
          updateAdminInfo(); // 관리자 정보 표시
          showDashboard();
          
          // 실시간 채팅 목록 업데이트 시작
          console.log('실시간 채팅 목록 업데이트 시작');
          showMessageList();
        } else {
          // 로그인되지 않은 경우 로그인 페이지로 이동
          console.log('로그인되지 않음, 로그인 페이지로 이동');
          updateAdminInfo(); // 관리자 정보 숨김
          window.location.href = 'admin_login.html';
        }
      });
      
      // 로그아웃 버튼 이벤트
      var logoutBtn = document.querySelector('.sidebar-bottom .logout');
      if (logoutBtn) {
        logoutBtn.onclick = function() {
          if (confirm('로그아웃하시겠습니까?')) {
            auth.signOut().then(() => {
              console.log('로그아웃 성공');
              // 로그아웃 후 로그인 페이지로 이동
              window.location.href = 'admin_login.html';
            }).catch((error) => {
              console.error('로그아웃 오류:', error);
              alert('로그아웃 중 오류가 발생했습니다.');
            });
          }
        };
      }
      
      // 도움말 버튼 이벤트
      var helpBtn = document.querySelector('.sidebar-bottom .help');
      if (helpBtn) {
        helpBtn.onclick = function() {
          alert('개발자 연락처\n\n이민구\n010-4689-7844');
        };
      }
      
      // 회원관리 검색 기능
      var memberSearch = document.getElementById('member-search');
      if (memberSearch) {
        memberSearch.addEventListener('input', function() {
          var searchValue = this.value.toLowerCase().trim();
          var rows = document.querySelectorAll('#member-view table tbody tr');
          var visibleCount = 0;
          
          rows.forEach(function(row) {
            var nameCell = row.children[1].textContent.toLowerCase();
            var studentIdCell = row.children[1].textContent.toLowerCase(); // 이름과 학번이 같은 셀에 있음
            
            if (searchValue === '' || nameCell.includes(searchValue) || studentIdCell.includes(searchValue)) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });
          
          // 검색 결과 개수 업데이트
          var titleElement = document.querySelector('#member-view .status-title');
          if (titleElement) {
            titleElement.textContent = '회원 관리 (' + visibleCount + '명)';
          }
        });
      }
      
      // 외박 신청 관리 검색 기능
      var leaveSearch = document.getElementById('leave-search');
      if (leaveSearch) {
        leaveSearch.addEventListener('input', function() {
          var searchValue = this.value.toLowerCase().trim();
          var rows = document.querySelectorAll('#dorm-leave-table tbody tr');
          var visibleCount = 0;
          
          rows.forEach(function(row) {
            var nameCell = row.children[1].textContent.toLowerCase(); // 이름
            var studentIdCell = row.children[2].textContent.toLowerCase(); // 학번
            
            if (searchValue === '' || nameCell.includes(searchValue) || studentIdCell.includes(searchValue)) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });
          
          // 검색 결과 개수 업데이트
          var titleElement = document.querySelector('#dorm-leave-view .status-title');
          if (titleElement) {
            titleElement.textContent = '외박 신청 내역 (' + visibleCount + '건)';
          }
        });
      }
      
      // 민원 관리 검색 기능
      var complaintSearch = document.getElementById('complaint-search');
      if (complaintSearch) {
        complaintSearch.addEventListener('input', function() {
          var searchValue = this.value.toLowerCase().trim();
          var rows = document.querySelectorAll('#complaint-table tbody tr');
          var visibleCount = 0;
          
          rows.forEach(function(row) {
            var nameCell = row.children[1].textContent.toLowerCase(); // 이름
            var studentIdCell = row.children[2].textContent.toLowerCase(); // 학번
            
            if (searchValue === '' || nameCell.includes(searchValue) || studentIdCell.includes(searchValue)) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });
          
          // 검색 결과 개수 업데이트
          var titleElement = document.querySelector('#complaint-view .status-title');
          if (titleElement) {
            titleElement.textContent = '민원 관리 (' + visibleCount + '건)';
          }
        });
      }
      
      // 상벌점 관리 검색 기능
      var pointSearch = document.getElementById('point-search');
      if (pointSearch) {
        pointSearch.addEventListener('input', function() {
          var searchValue = this.value.toLowerCase().trim();
          var rows = document.querySelectorAll('#point-table tbody tr');
          var visibleCount = 0;
          
          rows.forEach(function(row) {
            var nameCell = row.children[0].textContent.toLowerCase(); // 이름
            var studentIdCell = row.children[1].textContent.toLowerCase(); // 학번
            
            if (searchValue === '' || nameCell.includes(searchValue) || studentIdCell.includes(searchValue)) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });
          
          // 검색 결과 개수 업데이트
          var titleElement = document.querySelector('#point-view .status-title');
          if (titleElement) {
            titleElement.textContent = '상벌점 관리 (' + visibleCount + '건)';
          }
        });
      }
      
      // 퇴사 신청 관리 검색 기능
      var outSearch = document.getElementById('out-search');
      if (outSearch) {
        outSearch.addEventListener('input', function() {
          var searchValue = this.value.toLowerCase().trim();
          var rows = document.querySelectorAll('#dorm-out-table tbody tr');
          var visibleCount = 0;
          
          rows.forEach(function(row) {
            var nameCell = row.children[1].textContent.toLowerCase(); // 이름
            var studentIdCell = row.children[2].textContent.toLowerCase(); // 학번
            
            if (searchValue === '' || nameCell.includes(searchValue) || studentIdCell.includes(searchValue)) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });
          
          // 검색 결과 개수 업데이트
          var titleElement = document.querySelector('#dorm-out-view .status-title');
          if (titleElement) {
            titleElement.textContent = '퇴사 신청 내역 (' + visibleCount + '건)';
          }
        });
      }
      
      // 공지사항 관리 검색 기능
      var noticeSearch = document.getElementById('notice-search');
      if (noticeSearch) {
        noticeSearch.addEventListener('input', function() {
          var searchValue = this.value.toLowerCase().trim();
          var rows = document.querySelectorAll('#notice-table tbody tr');
          var visibleCount = 0;
          
          rows.forEach(function(row) {
            var titleCell = row.children[0].textContent.toLowerCase(); // 제목
            
            if (searchValue === '' || titleCell.includes(searchValue)) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });
          
          // 검색 결과 개수 업데이트
          var titleElement = document.querySelector('#notice-view .status-title');
          if (titleElement) {
            titleElement.textContent = '공지사항 관리 (' + visibleCount + '건)';
          }
        });
      }
      
      // 메시지 관리 검색 기능
      var messageSearch = document.getElementById('message-search');
      if (messageSearch) {
        messageSearch.addEventListener('input', function() {
          var searchValue = this.value.toLowerCase().trim();
          var messageElements = document.querySelectorAll('#message-list > div');
          var visibleCount = 0;
          
          messageElements.forEach(function(element) {
            var studentName = element.querySelector('div[style*="font-weight:600"]').textContent.toLowerCase();
            
            if (searchValue === '' || studentName.includes(searchValue)) {
              element.style.display = '';
              visibleCount++;
            } else {
              element.style.display = 'none';
            }
          });
          
          // 검색 결과가 없을 때 메시지 표시
          if (visibleCount === 0 && searchValue !== '') {
            var messageList = document.getElementById('message-list');
            if (!messageList.querySelector('.no-results')) {
              var noResultsElement = document.createElement('div');
              noResultsElement.className = 'no-results';
              noResultsElement.style.cssText = 'text-align:center;color:#888;padding:20px;';
              noResultsElement.textContent = '검색 결과가 없습니다.';
              messageList.appendChild(noResultsElement);
            }
          } else {
            // 검색 결과가 있을 때 "검색 결과 없음" 메시지 제거
            var noResultsElement = messageList.querySelector('.no-results');
            if (noResultsElement) {
              noResultsElement.remove();
            }
          }
          
          // 검색 결과 개수 업데이트
          var titleElement = document.querySelector('#message-view .status-title');
          if (titleElement) {
            titleElement.textContent = '메시지 관리 (' + visibleCount + '건)';
          }
        });
      }
      
      // 입사 신청 관리 검색 기능
      var inSearch = document.getElementById('in-search');
      if (inSearch) {
        inSearch.addEventListener('input', function() {
          var searchValue = this.value.toLowerCase().trim();
          var rows = document.querySelectorAll('#dorm-in-table tbody tr');
          var visibleCount = 0;
          
          rows.forEach(function(row) {
            var nameCell = row.children[1].textContent.toLowerCase(); // 이름
            var studentIdCell = row.children[2].textContent.toLowerCase(); // 학번
            
            if (searchValue === '' || nameCell.includes(searchValue) || studentIdCell.includes(searchValue)) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });
          
          // 검색 결과 개수 업데이트
          var titleElement = document.querySelector('#dorm-in-view .status-title');
          if (titleElement) {
            titleElement.textContent = '입사 신청 내역 (' + visibleCount + '건)';
          }
        });
      }
    };
    
    // ===== 외박 신청 관리 관련 =====
    // 외박신청 상태 select 색상 동적 변경
    function updateLeaveSelectColor(select) {
      if (!select) return;
      var val = select.value;
      if (val === '승인') {
        select.style.background = '#43a047';
        select.style.color = '#fff';
      } else if (val === '대기') {
        select.style.background = '#ffb300';
        select.style.color = '#fff';
      } else if (val === '반려') {
        select.style.background = '#d32f2f';
        select.style.color = '#fff';
      }
    }
    function initLeaveSelectColors() {
      var selects = document.querySelectorAll('.leave-status-select');
      selects.forEach(function(sel) {
        // 초기 상태 저장
        if (!sel.getAttribute('data-original-status')) {
          sel.setAttribute('data-original-status', sel.value);
        }
        updateLeaveSelectColor(sel);
        sel.onchange = function() { updateLeaveSelectColor(this); };
      });
    }
    // 체크박스 전체 선택
    var checkAllLeave = document.getElementById('check-all-leave');
    if (checkAllLeave) {
      checkAllLeave.onclick = function() {
        var checks = document.querySelectorAll('.leave-row-check');
        checks.forEach(function(chk) { chk.checked = checkAllLeave.checked; });
      };
    }
    // 확인하기 버튼 이벤트
    var leaveConfirmBtn = document.getElementById('leave-confirm-btn');
    if (leaveConfirmBtn) {
      leaveConfirmBtn.onclick = function() {
        var rows = document.querySelectorAll('#dorm-leave-table tbody tr');
        var result = [];
        var hasChanges = false;
        var checkedRows = [];
        
        // 체크된 행들 수집
        rows.forEach(function(row) {
          var checked = row.querySelector('.leave-row-check').checked;
          if (checked) {
            checkedRows.push(row);
          }
        });
        
        // 체크된 행들의 상태를 일괄 변경할 수 있는 옵션 제공
        if (checkedRows.length > 0) {
          var newStatus = prompt('선택된 외박 신청들의 상태를 변경하시겠습니까?\n\n1: 승인\n2: 대기\n3: 반려\n\n번호를 입력하세요 (취소하려면 취소를 누르세요):');
          
          if (newStatus !== null) {
            var statusMap = {'1': '승인', '2': '대기', '3': '반려'};
            var selectedStatus = statusMap[newStatus];
            
            if (selectedStatus) {
              checkedRows.forEach(function(row) {
                var name = row.children[1].textContent;
                var select = row.querySelector('.leave-status-select');
                select.value = selectedStatus;
                updateLeaveSelectColor(select);
                // 초기 상태 업데이트
                select.setAttribute('data-original-status', selectedStatus);
                result.push(name + ': ' + selectedStatus);
              });
              
              alert('일괄 변경 완료:\n' + result.join('\n'));
            } else {
              alert('잘못된 번호입니다. 1, 2, 3 중에서 선택해주세요.');
            }
          }
        } else {
          // 체크되지 않은 경우 기존 로직 (개별 상태 변경 확인)
          rows.forEach(function(row) {
            var name = row.children[1].textContent;
            var status = row.querySelector('.leave-status-select').value;
            var originalStatus = row.querySelector('.leave-status-select').getAttribute('data-original-status');
            
            if (originalStatus && originalStatus !== status) {
              hasChanges = true;
            result.push(name + ': ' + status);
          }
        });
          
          if (hasChanges) {
          alert('적용 대상:\n' + result.join('\n'));
            // 변경된 상태들을 초기 상태로 업데이트
            rows.forEach(function(row) {
              var select = row.querySelector('.leave-status-select');
              var originalStatus = select.getAttribute('data-original-status');
              var currentStatus = select.value;
              if (originalStatus && originalStatus !== currentStatus) {
                select.setAttribute('data-original-status', currentStatus);
              }
            });
          }
        }
        
        // 체크박스 모두 해제
        var checks = document.querySelectorAll('.leave-row-check');
        checks.forEach(function(chk) { chk.checked = false; });
        var checkAll = document.getElementById('check-all-leave');
        if (checkAll) checkAll.checked = false;
      };
    }

    // 퇴사신청 상태 select 색상 동적 변경
    function updateOutSelectColor(select) {
      if (!select) return;
      var val = select.value;
      if (val === '승인') {
        select.style.background = '#43a047';
        select.style.color = '#fff';
      } else if (val === '대기') {
        select.style.background = '#ffb300';
        select.style.color = '#fff';
      } else if (val === '반려') {
        select.style.background = '#d32f2f';
        select.style.color = '#fff';
      }
    }
    function initOutSelectColors() {
      var selects = document.querySelectorAll('.out-status-select');
      selects.forEach(function(sel) {
        // 초기 상태 저장
        if (!sel.getAttribute('data-original-status')) {
          sel.setAttribute('data-original-status', sel.value);
        }
        updateOutSelectColor(sel);
        sel.onchange = function() { updateOutSelectColor(this); };
      });
    }
    // 체크박스 전체 선택
    var checkAllOut = document.getElementById('check-all-out');
    if (checkAllOut) {
      checkAllOut.onclick = function() {
        var checks = document.querySelectorAll('.out-row-check');
        checks.forEach(function(chk) { chk.checked = checkAllOut.checked; });
      };
    }
    // 확인하기 버튼 이벤트
    var outConfirmBtn = document.getElementById('out-confirm-btn');
    if (outConfirmBtn) {
      outConfirmBtn.onclick = function() {
        var rows = document.querySelectorAll('#dorm-out-table tbody tr');
        var result = [];
        var hasChanges = false;
        var checkedRows = [];
        
        // 체크된 행들 수집
        rows.forEach(function(row) {
          var checked = row.querySelector('.out-row-check').checked;
          if (checked) {
            checkedRows.push(row);
          }
        });
        
        // 체크된 행들의 상태를 일괄 변경할 수 있는 옵션 제공
        if (checkedRows.length > 0) {
          var newStatus = prompt('선택된 퇴사 신청들의 상태를 변경하시겠습니까?\n\n1: 승인\n2: 대기\n3: 반려\n\n번호를 입력하세요 (취소하려면 취소를 누르세요):');
          
          if (newStatus !== null) {
            var statusMap = {'1': '승인', '2': '대기', '3': '반려'};
            var selectedStatus = statusMap[newStatus];
            
            if (selectedStatus) {
              checkedRows.forEach(function(row) {
                var name = row.children[1].textContent;
                var select = row.querySelector('.out-status-select');
                select.value = selectedStatus;
                updateOutSelectColor(select);
                // 초기 상태 업데이트
                select.setAttribute('data-original-status', selectedStatus);
                result.push(name + ': ' + selectedStatus);
              });
              
              alert('일괄 변경 완료:\n' + result.join('\n'));
            } else {
              alert('잘못된 번호입니다. 1, 2, 3 중에서 선택해주세요.');
            }
          }
        } else {
          // 체크되지 않은 경우 기존 로직 (개별 상태 변경 확인)
          rows.forEach(function(row) {
            var name = row.children[1].textContent;
            var status = row.querySelector('.out-status-select').value;
            var originalStatus = row.querySelector('.out-status-select').getAttribute('data-original-status');
            
            if (originalStatus && originalStatus !== status) {
              hasChanges = true;
            result.push(name + ': ' + status);
          }
        });
          
          if (hasChanges) {
          alert('적용 대상:\n' + result.join('\n'));
            // 변경된 상태들을 초기 상태로 업데이트
            rows.forEach(function(row) {
              var select = row.querySelector('.out-status-select');
              var originalStatus = select.getAttribute('data-original-status');
              var currentStatus = select.value;
              if (originalStatus && originalStatus !== currentStatus) {
                select.setAttribute('data-original-status', currentStatus);
              }
            });
          }
        }
        
        // 체크박스 모두 해제
        var checks = document.querySelectorAll('.out-row-check');
        checks.forEach(function(chk) { chk.checked = false; });
        var checkAll = document.getElementById('check-all-out');
        if (checkAll) checkAll.checked = false;
      };
    }
    // 민원관리 상태 select 색상 동적 변경
    function updateComplaintSelectColor(select) {
      if (!select) return;
      var val = select.value;
      if (val === '승인') {
        select.style.background = '#43a047';
        select.style.color = '#fff';
      } else if (val === '대기') {
        select.style.background = '#ffb300';
        select.style.color = '#fff';
      } else if (val === '반려') {
        select.style.background = '#d32f2f';
        select.style.color = '#fff';
      }
    }
    function initComplaintSelectColors() {
      var selects = document.querySelectorAll('.complaint-status-select');
      selects.forEach(function(sel) {
        // 초기 상태 저장
        if (!sel.getAttribute('data-original-status')) {
          sel.setAttribute('data-original-status', sel.value);
        }
        updateComplaintSelectColor(sel);
        sel.onchange = function() { 
          updateComplaintSelectColor(this); 
        };
      });
    }
    // 민원 상세보기 함수
    function showComplaintDetail(name, title) {
      var detailContent = '';
      if (title === '시설물 고장 신고') {
        detailContent = '화장실 수도관에서 물이 새고 있습니다. 201호 화장실에서 계속 물이 떨어지고 있어서 사용하기 어렵습니다. 빠른 수리가 필요합니다.';
      } else if (title === '소음 민원') {
        detailContent = '옆방에서 밤늦게까지 음악을 크게 틀어서 공부하기 어렵습니다. 조용히 해달라고 요청했지만 개선되지 않아 민원을 제기합니다.';
      } else if (title === '온수 공급 문제') {
        detailContent = '샤워실에서 온수가 나오지 않습니다. 며칠째 차가운 물만 나와서 샤워하기 어렵습니다. 온수 공급을 확인해주세요.';
      } else if (title === '보안 문 잠금 장치') {
        detailContent = '1층 보안문의 잠금 장치가 고장났습니다. 문이 제대로 닫히지 않아 보안상 문제가 될 수 있습니다.';
      }
      
      alert('민원 상세 내용\n\n신청자: ' + name + '\n제목: ' + title + '\n\n내용:\n' + detailContent);
    }
    // 민원관리 체크박스 전체 선택
    var checkAllComplaint = document.getElementById('check-all-complaint');
    if (checkAllComplaint) {
      checkAllComplaint.onclick = function() {
        var checks = document.querySelectorAll('.complaint-row-check');
        checks.forEach(function(chk) { chk.checked = checkAllComplaint.checked; });
      };
    }
    // 민원관리 확인하기 버튼 이벤트
    var complaintConfirmBtn = document.getElementById('complaint-confirm-btn');
    if (complaintConfirmBtn) {
      complaintConfirmBtn.onclick = function() {
        var rows = document.querySelectorAll('#complaint-table tbody tr');
        var result = [];
        var hasChanges = false;
        var checkedRows = [];
        
        // 체크된 행들 수집
        rows.forEach(function(row) {
          var checked = row.querySelector('.complaint-row-check').checked;
          if (checked) {
            checkedRows.push(row);
          }
        });
        
        // 체크된 행들의 상태를 일괄 변경할 수 있는 옵션 제공
        if (checkedRows.length > 0) {
          var newStatus = prompt('선택된 민원들의 상태를 변경하시겠습니까?\n\n1: 승인\n2: 대기\n3: 반려\n\n번호를 입력하세요 (취소하려면 취소를 누르세요):');
          
          if (newStatus !== null) {
            var statusMap = {'1': '승인', '2': '대기', '3': '반려'};
            var selectedStatus = statusMap[newStatus];
            
            if (selectedStatus) {
              checkedRows.forEach(function(row) {
                var name = row.children[1].textContent;
                var select = row.querySelector('.complaint-status-select');
                select.value = selectedStatus;
                updateComplaintSelectColor(select);
                // 초기 상태 업데이트
                select.setAttribute('data-original-status', selectedStatus);
                result.push(name + ': ' + selectedStatus);
              });
              
              alert('일괄 변경 완료:\n' + result.join('\n'));
            } else {
              alert('잘못된 번호입니다. 1, 2, 3 중에서 선택해주세요.');
            }
          }
        } else {
          // 체크되지 않은 경우 기존 로직 (개별 상태 변경 확인)
          rows.forEach(function(row) {
            var name = row.children[1].textContent;
            var status = row.querySelector('.complaint-status-select').value;
            var originalStatus = row.querySelector('.complaint-status-select').getAttribute('data-original-status');
            
            if (originalStatus && originalStatus !== status) {
              hasChanges = true;
              result.push(name + ': ' + status);
            }
          });
          
          if (hasChanges) {
            alert('적용 대상:\n' + result.join('\n'));
            // 변경된 상태들을 초기 상태로 업데이트
            rows.forEach(function(row) {
              var select = row.querySelector('.complaint-status-select');
              var originalStatus = select.getAttribute('data-original-status');
              var currentStatus = select.value;
              if (originalStatus && originalStatus !== currentStatus) {
                select.setAttribute('data-original-status', currentStatus);
              }
            });
          }
        }
        
        // 체크박스 모두 해제
        var checks = document.querySelectorAll('.complaint-row-check');
        checks.forEach(function(chk) { chk.checked = false; });
        var checkAll = document.getElementById('check-all-complaint');
        if (checkAll) checkAll.checked = false;
      };
    }
    // 상벌점 관리 상태 select 색상 동적 변경
    function updatePointSelectColor(select) {
      if (!select) return;
      var val = select.value;
      if (val === '상점') {
        select.style.background = '#43a047';
        select.style.color = '#fff';
      } else if (val === '벌점') {
        select.style.background = '#d32f2f';
        select.style.color = '#fff';
      } else if (val === '무효') {
        select.style.background = '#bdbdbd';
        select.style.color = '#222';
      }
    }
    function initPointSelectColors() {
      var selects = document.querySelectorAll('.point-status-select');
      selects.forEach(function(sel) {
        // 초기 상태 저장
        if (!sel.getAttribute('data-original-status')) {
          sel.setAttribute('data-original-status', sel.value);
        }
        updatePointSelectColor(sel);
        sel.onchange = function() { updatePointSelectColor(this); };
      });
    }
    // 상벌점 상세보기 함수
    function showPointDetail(name, date, reason, currentPoints) {
      var detailContent = '';
      if (reason === '정리정돈 우수') {
        detailContent = '개인 공간과 공용 공간을 깔끔하게 정리하여 다른 학생들에게 모범이 되었습니다.';
      } else if (reason === '소음 민원') {
        detailContent = '밤늦게까지 큰 소리로 음악을 틀어 다른 학생들의 휴식을 방해했습니다.';
      } else if (reason === '기숙사 행사 참여') {
        detailContent = '기숙사 문화 행사에 적극적으로 참여하여 기숙사 분위기 향상에 기여했습니다.';
      } else if (reason === '기숙사 규정 위반') {
        detailContent = '기숙사 내 흡연으로 인해 규정을 위반했습니다.';
      }
      
      alert('상벌점 상세 내용\n\n학생: ' + name + '\n날짜: ' + date + '\n사유: ' + reason + '\n점수: ' + currentPoints + '점\n\n상세 내용:\n' + detailContent);
    }
    
    // 입사 신청 상세보기 함수
    function showInDetail(name, studentId, major, grade, phone, desiredDate, applyDate) {
      var modalHtml = `
        <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;">
          <div style="background:#fff;border-radius:12px;padding:24px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
              <h3 style="margin:0;color:#333;">입사 신청 서류</h3>
              <button onclick="closeInDetail()" style="background:none;border:none;font-size:1.5em;cursor:pointer;color:#666;">×</button>
            </div>
            <div style="margin-bottom:20px;">
              <div style="font-weight:600;color:#333;margin-bottom:12px;">신청자 정보</div>
              <div style="padding:16px;background:#f8f9fa;border-radius:8px;margin-bottom:16px;">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                  <div><strong>이름:</strong> ${name}</div>
                  <div><strong>학번:</strong> ${studentId}</div>
                  <div><strong>학과:</strong> ${major}</div>
                  <div><strong>학년:</strong> ${grade}</div>
                  <div><strong>연락처:</strong> ${phone}</div>
                  <div><strong>희망 입사일:</strong> ${desiredDate}</div>
                  <div><strong>신청일:</strong> ${applyDate}</div>
                </div>
              </div>
            </div>
            <div style="margin-bottom:20px;">
              <div style="font-weight:600;color:#333;margin-bottom:12px;">필수 서류</div>
              <div style="padding:16px;background:#f8f9fa;border-radius:8px;">
                <div style="margin-bottom:8px;">✓ 입사 신청서</div>
                <div style="margin-bottom:8px;">✓ 학생증 사본</div>
                <div style="margin-bottom:8px;">✓ 주민등록등본</div>
                <div style="margin-bottom:8px;">✓ 건강진단서</div>
                <div style="margin-bottom:8px;">✓ 보호자 동의서</div>
                <div style="margin-bottom:8px;">✓ 기숙사비 납부 확인서</div>
                <div style="margin-bottom:8px;">✓ 개인정보 수집·이용 동의서</div>
                <div>✓ 기숙사 생활규정 동의서</div>
              </div>
            </div>
            <div style="margin-bottom:20px;">
              <div style="font-weight:600;color:#333;margin-bottom:12px;">추가 서류</div>
              <div style="padding:16px;background:#f8f9fa;border-radius:8px;">
                <div style="margin-bottom:8px;">✓ 장애학생 지원 신청서 (해당자)</div>
                <div style="margin-bottom:8px;">✓ 특별 지원 신청서 (해당자)</div>
                <div>✓ 기타 관련 서류</div>
              </div>
            </div>
            <div style="text-align:center;">
              <button onclick="closeInDetail()" style="padding:8px 24px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;">닫기</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    
    // 입사 신청 상세보기 닫기 함수
    function closeInDetail() {
      var modal = document.querySelector('div[style*="position:fixed"]');
      if (modal) modal.remove();
    }
    
    // 입사 신청 상태 select 색상 동적 변경
    function updateInSelectColor(select) {
      if (!select) return;
      var val = select.value;
      if (val === '승인') {
        select.style.background = '#43a047';
        select.style.color = '#fff';
      } else if (val === '대기') {
        select.style.background = '#ffb300';
        select.style.color = '#fff';
      } else if (val === '반려') {
        select.style.background = '#d32f2f';
        select.style.color = '#fff';
      }
    }
    
    function initInSelectColors() {
      var selects = document.querySelectorAll('.in-status-select');
      selects.forEach(function(sel) {
        // 초기 상태 저장
        if (!sel.getAttribute('data-original-status')) {
          sel.setAttribute('data-original-status', sel.value);
        }
        updateInSelectColor(sel);
        sel.onchange = function() { updateInSelectColor(this); };
      });
    }
    // 상벌점 관리 체크박스 전체 선택
    var checkAllPoint = document.getElementById('check-all-point');
    if (checkAllPoint) {
      checkAllPoint.onclick = function() {
        var checks = document.querySelectorAll('.point-row-check');
        checks.forEach(function(chk) { chk.checked = checkAllPoint.checked; });
      };
    }
    // 상벌점 추가 버튼 이벤트
    var addPointBtn = document.getElementById('add-point-btn');
    if (addPointBtn) {
      addPointBtn.onclick = function() {
        showAddPointForm();
      };
    }
    // 한국 시간 형식으로 날짜 변환 함수
    function getKoreanDateString(date) {
      var year = date.getFullYear();
      var month = String(date.getMonth() + 1).padStart(2, '0');
      var day = String(date.getDate()).padStart(2, '0');
      return year + '-' + month + '-' + day;
    }
    
    // 상벌점 추가 폼 표시 함수
    function showAddPointForm() {
      var today = new Date();
      var todayStr = getKoreanDateString(today);
      var formHtml = `
        <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;">
          <div style="background:#fff;border-radius:18px;padding:32px;width:500px;max-width:90vw;">
            <h3 style="margin:0 0 24px 0;color:#333;">새로운 상벌점 추가</h3>
            <div style="display:grid;gap:16px;">
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">학생 검색</label>
                <input type="text" id="new-point-student-search" placeholder="학생 이름 또는 학번을 입력하세요" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
                <div id="student-search-results" style="max-height:150px;overflow-y:auto;margin-top:8px;border:1px solid #ddd;border-radius:8px;display:none;">
                  <div class="student-option" data-value="고다현|20230709|소프트웨어융합대학|남자|201호" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;">고다현 (20230709) - 소프트웨어융합대학 2학년</div>
                  <div class="student-option" data-value="노홍철|20230627|Lorem ipsum dolor sit amet...|여자|305호" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;">노홍철 (20230627) - Lorem ipsum dolor sit amet...</div>
                  <div class="student-option" data-value="이하준|20230528|Lorem ipsum dolor sit amet...|남자|110호" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;">이하준 (20230528) - Lorem ipsum dolor sit amet...</div>
                  <div class="student-option" data-value="Leo Stanton|20230413|Lorem ipsum dolor sit amet...|여자|405호" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;">Leo Stanton (20230413) - Lorem ipsum dolor sit amet...</div>
                  <div class="student-option" data-value="Kayla Vetovos|20230316|Lorem ipsum dolor sit amet...|여자|505호" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;">Kayla Vetovos (20230316) - Lorem ipsum dolor sit amet...</div>
                </div>
              </div>
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">상벌점 사유</label>
                <input type="text" id="new-point-reason" placeholder="상벌점 사유를 입력하세요" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
              </div>
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">날짜</label>
                                  <input type="date" id="new-point-date" value="${todayStr}" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
              </div>
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">점수</label>
                <input type="number" id="new-point-score" placeholder="점수를 입력하세요 (양수: 상점, 음수: 벌점)" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
              </div>

            </div>
            <div style="display:flex;gap:12px;margin-top:24px;">
              <button onclick="addNewPoint()" style="flex:1;padding:12px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;">추가</button>
              <button onclick="closeAddPointForm()" style="flex:1;padding:12px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#f5f5f5;color:#333;cursor:pointer;">취소</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', formHtml);
      
      // 학생 검색 기능 초기화
      setTimeout(function() {
        var searchInput = document.getElementById('new-point-student-search');
        var resultsDiv = document.getElementById('student-search-results');
        var studentOptions = document.querySelectorAll('.student-option');
        
        // 검색 입력 이벤트
        searchInput.addEventListener('input', function() {
          var searchTerm = this.value.toLowerCase();
          var hasResults = false;
          
          studentOptions.forEach(function(option) {
            var text = option.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
              option.style.display = 'block';
              hasResults = true;
            } else {
              option.style.display = 'none';
            }
          });
          
          if (hasResults && searchTerm.length > 0) {
            resultsDiv.style.display = 'block';
          } else {
            resultsDiv.style.display = 'none';
          }
        });
        
        // 학생 선택 이벤트
        studentOptions.forEach(function(option) {
          option.addEventListener('click', function() {
            var studentData = this.getAttribute('data-value');
            var studentText = this.textContent;
            searchInput.value = studentText;
            searchInput.setAttribute('data-selected', studentData);
            resultsDiv.style.display = 'none';
          });
          
          // 호버 효과
          option.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f5f5f5';
          });
          option.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
          });
        });
      }, 100);
    }
    
    // 공지사항 관련 함수들
    var noticeCounter = 4; // 다음 공지사항 번호
    
    // 공지사항 상세보기
    function showNoticeDetail(title, author, date, content) {
      alert('공지사항 상세보기\n\n제목: ' + title + '\n작성자: ' + author + '\n작성일: ' + date + '\n\n내용:\n' + content);
    }
    
    // 공지사항 추가 폼 표시
    function showAddNoticeForm() {
      var today = new Date();
      var todayStr = getKoreanDateString(today);
      var formHtml = `
        <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;">
          <div style="background:#fff;border-radius:18px;padding:32px;width:600px;max-width:90vw;">
            <h3 style="margin:0 0 24px 0;color:#333;">새로운 공지사항 추가</h3>
            <div style="display:grid;gap:16px;">
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">제목</label>
                <input type="text" id="new-notice-title" placeholder="공지사항 제목을 입력하세요" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
              </div>
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">내용</label>
                <textarea id="new-notice-content" placeholder="공지사항 내용을 입력하세요" rows="8" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;resize:vertical;"></textarea>
              </div>
                              <div>
                  <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">작성일</label>
                  <input type="date" id="new-notice-date" value="${todayStr}" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
                </div>
            </div>
            <div style="display:flex;gap:12px;margin-top:24px;">
              <button onclick="addNewNotice()" style="flex:1;padding:12px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;">추가</button>
              <button onclick="closeAddNoticeForm()" style="flex:1;padding:12px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#f5f5f5;color:#333;cursor:pointer;">취소</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', formHtml);
    }
    
    // 공지사항 추가 함수
    function addNewNotice() {
      var title = document.getElementById('new-notice-title').value;
      var content = document.getElementById('new-notice-content').value;
      var date = document.getElementById('new-notice-date').value;
      
      if (!title || !content || !date) {
        alert('모든 필드를 입력해주세요.');
        return;
      }
      
      // 새로운 행 추가
      var tbody = document.querySelector('#notice-table tbody');
      var newRow = document.createElement('tr');
      
      newRow.innerHTML = `
        <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showNoticeDetail('${title}', '관리자', '${date}', '${content}')">${title}</td>
        <td>관리자</td>
        <td>${date}</td>
        <td>0</td>
        <td>
          <button onclick="editNotice(${noticeCounter})" style="padding:4px 8px;font-size:0.9em;border:none;border-radius:4px;background:#4d7bbd;color:#fff;cursor:pointer;margin-right:4px;">수정</button>
          <button onclick="deleteNotice(${noticeCounter})" style="padding:4px 8px;font-size:0.9em;border:none;border-radius:4px;background:#d32f2f;color:#fff;cursor:pointer;">삭제</button>
        </td>
      `;
      
      tbody.appendChild(newRow);
      noticeCounter++;
      
      closeAddNoticeForm();
      alert('공지사항이 추가되었습니다.');
    }
    
    // 공지사항 추가 폼 닫기
    function closeAddNoticeForm() {
      var modal = document.querySelector('div[style*="position:fixed"]');
      if (modal) modal.remove();
    }
    
    // 공지사항 수정
    function editNotice(id) {
      var row = document.querySelector(`#notice-table tbody tr:nth-child(${id})`);
      if (row) {
        var title = row.children[1].textContent;
        var content = prompt('공지사항 내용을 수정하세요:', '수정된 내용을 입력하세요');
        if (content) {
          row.children[1].setAttribute('onclick', `showNoticeDetail('${title}', '관리자', '${row.children[3].textContent}', '${content}')`);
          alert('공지사항이 수정되었습니다.');
        }
      }
    }
    
    // 공지사항 삭제
    function deleteNotice(id) {
      if (confirm('정말로 이 공지사항을 삭제하시겠습니까?')) {
        var row = document.querySelector(`#notice-table tbody tr:nth-child(${id})`);
        if (row) {
          row.remove();
          alert('공지사항이 삭제되었습니다.');
        }
      }
    }
    
    // 공지사항 추가 버튼 이벤트
    var addNoticeBtn = document.getElementById('add-notice-btn');
    if (addNoticeBtn) {
      addNoticeBtn.onclick = showAddNoticeForm;
    }
    
    // 일정관리 관련 함수들
    var currentDate = new Date();
    var currentMonth = currentDate.getMonth();
    var currentYear = currentDate.getFullYear();
    var schedules = [
      // 기본 일정 없음 - 사용자가 직접 추가
    ];
    
    // 달력 생성 함수
    function generateCalendar(year, month) {
      var firstDay = new Date(year, month, 1);
      var lastDay = new Date(year, month + 1, 0);
      var startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());
      
      var calendarGrid = document.getElementById('calendar-grid');
      var headerCells = calendarGrid.querySelectorAll('div');
      
      // 요일 헤더는 유지하고 나머지 제거
      for (var i = 7; i < headerCells.length; i++) {
        headerCells[i].remove();
      }
      
      // 달력 날짜 생성
      var currentDate = new Date(startDate);
      var endDate = new Date(lastDay);
      endDate.setDate(endDate.getDate() + (6 - lastDay.getDay()));
      
      while (currentDate <= endDate) {
        var dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.setAttribute('data-date', getKoreanDateString(currentDate));
        dayElement.style.cssText = 'background:#fff;padding:12px;min-height:80px;cursor:pointer;position:relative;border:1px solid #f0f0f0;';
        
        var dayNumber = document.createElement('div');
        dayNumber.style.cssText = 'font-weight:600;margin-bottom:4px;';
        dayNumber.textContent = currentDate.getDate();
        
        // 현재 날짜인지 확인
        var today = new Date();
        var isToday = currentDate.getDate() === today.getDate() && 
                     currentDate.getMonth() === today.getMonth() && 
                     currentDate.getFullYear() === today.getFullYear();
        
        // 이번 달이 아닌 날짜는 회색으로 표시
        if (currentDate.getMonth() !== month) {
          dayNumber.style.color = '#ccc';
        }
        
        // 현재 날짜면 배경색 변경
        if (isToday && currentDate.getMonth() === month) {
          dayElement.style.backgroundColor = '#e3f2fd';
          dayElement.style.border = '2px solid #1976d2';
          dayElement.style.borderRadius = '8px';
        }
        
        dayElement.appendChild(dayNumber);
        calendarGrid.appendChild(dayElement);
        
        currentDate.setDate(currentDate.getDate() + 1);
      }
      
      // 일정 점 표시
      updateCalendar();
    }
    
    // 달력 초기화
    function initCalendar() {
      // 한국 시간으로 현재 날짜 가져오기
      var now = new Date();
      currentYear = now.getFullYear();
      currentMonth = now.getMonth();
      generateCalendar(currentYear, currentMonth);
      updateMonthDisplay();
    }
    
    // 일주일 일정 표시 함수
    function showWeeklySchedule() {
      var today = new Date();
      var weeklySchedule = document.getElementById('weekly-schedule');
      weeklySchedule.innerHTML = '';
      
      // 앞으로의 일주일 일정 필터링 (당일 포함) - 한국 시간 기준
      var upcomingSchedules = schedules.filter(function(schedule) {
        var scheduleDate = new Date(schedule.date + 'T00:00:00');
        var todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
        var weekFromNow = new Date(todayStart);
        weekFromNow.setDate(todayStart.getDate() + 7);
        return scheduleDate >= todayStart && scheduleDate <= weekFromNow;
      });
      
      if (upcomingSchedules.length === 0) {
        weeklySchedule.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">앞으로의 일주일간 예정된 일정이 없습니다.</div>';
        return;
      }
      
      // 일정을 날짜순으로 정렬
      upcomingSchedules.sort(function(a, b) {
        return new Date(a.date) - new Date(b.date);
      });
      
      // 일정 표시
      upcomingSchedules.forEach(function(schedule) {
        var scheduleDate = new Date(schedule.date);
        var dayNames = ['일', '월', '화', '수', '목', '금', '토'];
        var dayName = dayNames[scheduleDate.getDay()];
        var month = scheduleDate.getMonth() + 1;
        var day = scheduleDate.getDate();
        
        var scheduleElement = document.createElement('div');
        scheduleElement.style.cssText = 'display:flex;align-items:center;padding:12px;border-radius:8px;background:#f8f9fa;border-left:4px solid ' + schedule.color + ';';
        
        scheduleElement.innerHTML = `
          <div style="flex:1;">
            <div style="font-weight:600;color:#333;margin-bottom:4px;">${schedule.title}</div>
            <div style="font-size:0.9em;color:#666;">${month}월 ${day}일 (${dayName})</div>
          </div>
          <div style="width:12px;height:12px;background:${schedule.color};border-radius:50%;margin-left:12px;"></div>
        `;
        
        weeklySchedule.appendChild(scheduleElement);
      });
    }
    
    // 월 표시 업데이트
    function updateMonthDisplay() {
      var monthNames = ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'];
      document.getElementById('current-month').textContent = currentYear + '년 ' + monthNames[currentMonth];
    }
    
    // 이전 월 버튼
    document.getElementById('prev-month').onclick = function() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      generateCalendar(currentYear, currentMonth);
      updateMonthDisplay();
    };
    
    // 다음 월 버튼
    document.getElementById('next-month').onclick = function() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      generateCalendar(currentYear, currentMonth);
      updateMonthDisplay();
    };
    
    // 년도/월 검색으로 이동
    document.getElementById('go-to-date').onclick = function() {
      var yearInput = document.getElementById('year-search');
      var monthInput = document.getElementById('month-search');
      
      var year = parseInt(yearInput.value);
      var month = parseInt(monthInput.value);
      
      if (isNaN(year) || isNaN(month)) {
        alert('올바른 년도와 월을 입력해주세요.');
        return;
      }
      
      if (year < 2000 || year > 2100) {
        alert('년도는 2000년부터 2100년까지 입력 가능합니다.');
        return;
      }
      
      if (month < 1 || month > 12) {
        alert('월은 1부터 12까지 입력 가능합니다.');
        return;
      }
      
      currentYear = year;
      currentMonth = month - 1; // JavaScript는 0부터 시작하므로 -1
      generateCalendar(currentYear, currentMonth);
      updateMonthDisplay();
      
      // 입력 필드 초기화
      yearInput.value = '';
      monthInput.value = '';
    };
    
    // Enter 키로도 이동 가능하도록
    document.addEventListener('DOMContentLoaded', function() {
      var yearInput = document.getElementById('year-search');
      var monthInput = document.getElementById('month-search');
      
      if (yearInput && monthInput) {
        yearInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            document.getElementById('go-to-date').click();
          }
        });
        
        monthInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            document.getElementById('go-to-date').click();
          }
        });
      }
    });
    
    // 일정 추가 폼 표시
    function showAddScheduleForm() {
      var today = new Date();
      var todayStr = getKoreanDateString(today);
      selectedColor = '#4d7bbd'; // 기본 색상으로 초기화
      var formHtml = `
        <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;">
          <div style="background:#fff;border-radius:18px;padding:32px;width:500px;max-width:90vw;">
            <h3 style="margin:0 0 24px 0;color:#333;">새로운 일정 추가</h3>
            <div style="display:grid;gap:16px;">
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">일정 제목</label>
                <input type="text" id="new-schedule-title" placeholder="일정 제목을 입력하세요" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
              </div>
                              <div>
                  <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">날짜</label>
                  <input type="date" id="new-schedule-date" value="${todayStr}" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
                </div>
              <div>
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#555;">색상 선택</label>
                <div style="display:flex;gap:8px;">
                  <div style="width:30px;height:30px;background:#4d7bbd;border-radius:50%;cursor:pointer;border:3px solid #4d7bbd;" onclick="selectColor('#4d7bbd')"></div>
                  <div style="width:30px;height:30px;background:#43a047;border-radius:50%;cursor:pointer;border:3px solid #ddd;" onclick="selectColor('#43a047')"></div>
                  <div style="width:30px;height:30px;background:#d32f2f;border-radius:50%;cursor:pointer;border:3px solid #ddd;" onclick="selectColor('#d32f2f')"></div>
                  <div style="width:30px;height:30px;background:#ff9800;border-radius:50%;cursor:pointer;border:3px solid #ddd;" onclick="selectColor('#ff9800')"></div>
                  <div style="width:30px;height:30px;background:#9c27b0;border-radius:50%;cursor:pointer;border:3px solid #ddd;" onclick="selectColor('#9c27b0')"></div>
                </div>
              </div>
            </div>
            <div style="display:flex;gap:12px;margin-top:24px;">
              <button onclick="addNewSchedule()" style="flex:1;padding:12px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;">추가</button>
              <button onclick="closeAddScheduleForm()" style="flex:1;padding:12px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#f5f5f5;color:#333;cursor:pointer;">취소</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', formHtml);
    }
    
    // 색상 선택
    var selectedColor = '#4d7bbd'; // 기본 색상
    
    function selectColor(color) {
      var colorButtons = document.querySelectorAll('div[onclick^="selectColor"]');
      colorButtons.forEach(function(btn) {
        btn.style.border = '3px solid #ddd';
      });
      event.target.style.border = '3px solid ' + color;
      selectedColor = color; // 전역 변수에 선택된 색상 저장
    }
    
    // 일정 추가 함수
    function addNewSchedule() {
      var title = document.getElementById('new-schedule-title').value;
      var date = document.getElementById('new-schedule-date').value;
      var color = selectedColor; // 전역 변수에서 선택된 색상 사용
      
      if (!title || !date) {
        alert('모든 필드를 입력해주세요.');
        return;
      }
      
      // 한국 시간 형식으로 날짜 변환
      var dateObj = new Date(date);
      var koreanDate = getKoreanDateString(dateObj);
      
      schedules.push({ date: koreanDate, title: title, color: color });
      updateCalendar();
      showWeeklySchedule();
      
      closeAddScheduleForm();
      alert('일정이 추가되었습니다.');
    }
    
    // 일정 추가 폼 닫기
    function closeAddScheduleForm() {
      var modal = document.querySelector('div[style*="position:fixed"]');
      if (modal) modal.remove();
    }
    
    // 달력 업데이트
    function updateCalendar() {
      var calendarDays = document.querySelectorAll('.calendar-day');
      calendarDays.forEach(function(day) {
        var date = day.getAttribute('data-date');
        var schedule = schedules.find(s => s.date === date);
        
        // 기존 일정 점 제거
        var existingDots = day.querySelectorAll('.schedule-dot');
        existingDots.forEach(dot => dot.remove());
        
        // 새 일정 점 추가
        if (schedule) {
          var dot = document.createElement('div');
          dot.className = 'schedule-dot';
          dot.style.cssText = `width:8px;height:8px;background:${schedule.color};border-radius:50%;margin:2px 0;`;
          day.appendChild(dot);
        }
      });
    }
    
    // 일정 삭제
    function deleteSchedule(date) {
      if (confirm('정말로 이 일정을 삭제하시겠습니까?')) {
        schedules = schedules.filter(s => s.date !== date);
        updateCalendar();
        showWeeklySchedule();
        alert('일정이 삭제되었습니다.');
      }
    }
    
    // 일정 추가 버튼 이벤트
    var addScheduleBtn = document.getElementById('add-schedule-btn');
    if (addScheduleBtn) {
      addScheduleBtn.onclick = showAddScheduleForm;
    }
    
    // 달력 날짜 클릭 이벤트
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('calendar-day')) {
        var date = e.target.getAttribute('data-date');
        var schedule = schedules.find(s => s.date === date);
        if (schedule) {
          var action = confirm('일정: ' + schedule.title + '\n\n(취소하면 삭제)');
          if (action) {
            // 확인 누르면 창만 닫힘
          } else {
            deleteSchedule(date);
          }
        } else {
          // 새 일정 추가
          showAddScheduleForm();
          document.getElementById('new-schedule-date').value = date;
        }
      }
    });
    
    // 상벌점 추가 함수
    function addNewPoint() {
      var selectedStudent = document.getElementById('new-point-student-search').getAttribute('data-selected');
      var reason = document.getElementById('new-point-reason').value;
      var date = document.getElementById('new-point-date').value;
      var score = parseInt(document.getElementById('new-point-score').value);
      
      if (!selectedStudent || !reason || !date || isNaN(score)) {
        alert('모든 필드를 입력해주세요.');
        return;
      }
      
      var studentInfo = selectedStudent.split('|');
      var name = studentInfo[0];
      var studentId = studentInfo[1];
      var major = studentInfo[2];
      var gender = studentInfo[3];
      var room = studentInfo[4];
      
      // 새로운 행 추가
      var tbody = document.querySelector('#point-table tbody');
      var newRow = document.createElement('tr');
      
      var scoreText = score >= 0 ? '+' + score + '점' : score + '점';
      var scoreColor = score >= 0 ? '#43a047' : '#d32f2f';
      
      // 한국 시간 형식으로 날짜 변환
      var dateObj = new Date(date);
      var koreanDate = getKoreanDateString(dateObj);
      
      newRow.innerHTML = `
        <td>${name}</td>
        <td>${studentId}</td>
        <td>${major}</td>
        <td>${gender}</td>
        <td>${room}</td>
        <td>${koreanDate}</td>
        <td style="color:${scoreColor};font-weight:600;">${scoreText}</td>
        <td style="cursor:pointer;color:#1976d2;text-decoration:underline;" onclick="showPointDetail('${name}', '${koreanDate}', '${reason}', ${score})">${reason}</td>
      `;
      
      tbody.appendChild(newRow);
      
      closeAddPointForm();
      alert('상벌점이 추가되었습니다.');
    }
    // 상벌점 추가 폼 닫기 함수
    function closeAddPointForm() {
      var form = document.querySelector('div[style*="position:fixed"]');
      if (form) {
        form.remove();
      }
    }
    // 상벌점 관리 확인하기 버튼 이벤트
    var pointConfirmBtn = document.getElementById('point-confirm-btn');
    if (pointConfirmBtn) {
      pointConfirmBtn.onclick = function() {
        var rows = document.querySelectorAll('#point-table tbody tr');
        var totalCount = rows.length;
        
        if (totalCount > 0) {
          alert('상벌점 관리 완료\n\n총 ' + totalCount + '개의 상벌점이 등록되어 있습니다.');
        } else {
          alert('등록된 상벌점이 없습니다.');
        }
      };
    }
    // ===== 출석/점호 관리 관련 =====
    // 출석/점호 검색 필터링
    var attendanceSearch = document.getElementById('attendance-search');
    if (attendanceSearch) {
      attendanceSearch.addEventListener('input', function() {
        var val = this.value.trim();
        var rows = document.querySelectorAll('#attendance-table tbody tr');
        rows.forEach(function(row) {
          var nameCell = row.children[1].textContent;
          if (!val || nameCell.indexOf(val) !== -1) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });
    }



    // 관리자 정보 표시 함수
    function updateAdminInfo() {
      const adminInfo = document.getElementById('admin-info');
      const adminName = document.getElementById('admin-name');
      const adminFilter = document.getElementById('admin-type-filter');
      
      if (currentAdmin) {
        // 이메일을 기반으로 관리자 타입 결정
        let adminType = '';
        let adminTypeValue = '';
        switch (currentAdmin.email) {
          case 'director@dormi.com':
            adminType = '실장님';
            adminTypeValue = 'director';
            break;
          case 'supervisor@dormi.com':
            adminType = '사감님';
            adminTypeValue = 'supervisor';
            break;
          case 'floor_manager@dormi.com':
            adminType = '층장님';
            adminTypeValue = 'floor_manager';
            break;
          default:
            adminType = '관리자';
            adminTypeValue = 'all';
        }
        
        adminName.textContent = adminType;
        adminInfo.style.display = 'block';
        
        // 현재 관리자 표시
        const currentAdminDisplay = document.getElementById('current-admin-display');
        if (currentAdminDisplay) {
          currentAdminDisplay.textContent = adminType;
        }
      } else {
        adminInfo.style.display = 'none';
      }
    }



    // 학생별 채팅방 목록 로드 함수
    function loadStudentChats() {
      console.log('loadStudentChats 함수 호출');
      
      if (!currentAdmin) {
        console.log('관리자가 로그인되지 않았습니다.');
        return;
      }

      console.log('Firestore에서 채팅방 목록 로드 시작');
      
      // Firestore에서 학생별 채팅방 목록 실시간 구독
      db.collection('chats')
        .orderBy('updatedAt', 'desc')
        .onSnapshot((snapshot) => {
          console.log('채팅방 스냅샷 수신:', snapshot.size, '개');
          const studentChats = [];
          snapshot.forEach((doc) => {
            const data = doc.data();
            console.log('채팅방 데이터:', doc.id, data);
            
            // 모든 채팅방 표시 (디버깅용)
            studentChats.push({
              chatId: doc.id,
              studentName: data.studentName || '알 수 없는 사용자',
              studentId: data.studentId || 'unknown',
              lastMessage: data.lastMessage || '메시지가 없습니다.',
              lastMessageTime: data.lastMessageTime,
              lastMessageBy: data.lastMessageBy || 'student',
              unread: data.lastMessageBy === 'student' // 학생이 마지막 메시지를 보낸 경우 읽지 않은 것으로 표시
            });
          });
          
          console.log('표시할 채팅방:', studentChats);
          // 학생 채팅방 목록 업데이트
          updateStudentChatList(studentChats);
        }, (error) => {
          console.error('학생 채팅방 로드 오류:', error);
        });
    }

    // 학생 채팅방 목록 업데이트 함수
    function updateStudentChatList(studentChats) {
      console.log('updateStudentChatList 함수 호출');
      const chatList = document.getElementById('chat-list');
      if (!chatList) {
        console.error('chat-list 요소를 찾을 수 없습니다.');
        return;
      }

      console.log('채팅방 개수:', studentChats.length);
      chatList.innerHTML = '';
      
      if (studentChats.length === 0) {
        chatList.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">학생 채팅방이 없습니다.<br>앱에서 메시지를 보내면 여기에 표시됩니다.</div>';
        return;
      }

      // 학생 채팅방 목록 표시
      studentChats.forEach(chat => {
        const chatElement = document.createElement('div');
        
        // 새로운 메시지가 있는지 확인
        if (chat.unread) {
          // 새로운 메시지가 있는 채팅방 - 빨간색 테두리와 빨간색 배경 + 애니메이션
          chatElement.style.cssText = 'display:flex;align-items:center;padding:16px;border-radius:8px;background:#ffebee;border-left:4px solid #d32f2f;cursor:pointer;margin-bottom:8px;box-shadow:0 2px 8px rgba(211, 50, 47, 0.3);animation:newMessageGlow 2s infinite;';
        } else {
          // 일반 채팅방 - 파란색 테두리와 회색 배경
          chatElement.style.cssText = 'display:flex;align-items:center;padding:16px;border-radius:8px;background:#f8f9fa;border-left:4px solid #4d7bbd;cursor:pointer;margin-bottom:8px;';
        }
      
        const timeString = chat.lastMessageTime ? new Date(chat.lastMessageTime.toDate()).toLocaleString('ko-KR') : '방금 전';
        
        chatElement.innerHTML = `
          <div style="flex:1;">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
              <div style="font-weight:600;color:${chat.unread ? '#d32f2f' : '#333'};">${chat.studentName}</div>
              ${chat.unread ? '<span style="background:#d32f2f;color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;animation:pulse 2s infinite;">🆕 새</span>' : ''}
            </div>
            <div style="font-size:0.9em;color:${chat.unread ? '#d32f2f' : '#666'};font-weight:${chat.unread ? '600' : '400'};">${chat.lastMessage}</div>
          </div>
          <div style="text-align:right;font-size:0.8em;color:${chat.unread ? '#d32f2f' : '#888'};">${timeString}</div>
        `;
        
        chatElement.addEventListener('click', function() {
          showChatWithStudent(chat.studentName, chat.studentId, chat.chatId);
        });
        
        chatList.appendChild(chatElement);
      });
    }

    // 학생과의 채팅창 표시 함수
    function showChatWithStudent(studentName, studentId, chatId) {
      const modalHtml = `
        <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;">
          <div style="background:#fff;border-radius:12px;padding:24px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
              <h3 style="margin:0;color:#333;">${studentName}</h3>
              <button onclick="closeChatModal()" style="background:none;border:none;font-size:1.5em;cursor:pointer;color:#666;">×</button>
            </div>
            <div style="margin-bottom:16px;padding:12px;background:#f8f9fa;border-radius:8px;">
              <div style="font-weight:600;color:#333;">${studentName}</div>
              <div style="font-size:0.9em;color:#666;">실시간 채팅</div>
            </div>
            <div id="chat-messages" style="margin-bottom:20px;max-height:300px;overflow-y:auto;border:1px solid #ddd;border-radius:8px;padding:12px;">
              <!-- 채팅 메시지들이 여기에 표시됩니다 -->
            </div>
            <div style="display:flex;gap:8px;">
              <input type="text" id="chat-input" placeholder="메시지를 입력하세요..." style="flex:1;padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:1rem;">
              <button onclick="sendAdminMessage('${studentName}', '${studentId}', '${chatId}')" style="padding:8px 16px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;">전송</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // 실시간 채팅 메시지 구독
      loadChatMessages(chatId);
    }

    // 채팅 메시지 로드 함수
    function loadChatMessages(chatId) {
      const chatMessages = document.getElementById('chat-messages');
      if (!chatMessages) return;

      // Firestore에서 해당 학생의 개별 채팅방 메시지 실시간 구독
      db.collection('chats').doc(chatId).collection('messages')
        .orderBy('timestamp', 'asc')
        .onSnapshot((snapshot) => {
          chatMessages.innerHTML = '';
          
          snapshot.forEach((doc) => {
            const data = doc.data();
            const messageElement = document.createElement('div');
            messageElement.style.cssText = 'margin-bottom:12px;';
            
            const timeString = data.timestamp ? new Date(data.timestamp.toDate()).toLocaleString('ko-KR') : '방금 전';
            
            // 새로운 메시지인지 확인 (5분 이내)
            const messageTime = data.timestamp ? data.timestamp.toDate() : new Date();
            const now = new Date();
            const isNewMessage = (now - messageTime) < 5 * 60 * 1000; // 5분 이내
            
            if (data.isAdmin) {
              // 관리자 메시지 (오른쪽 정렬) - 파란색 배경, 흰색 텍스트
              messageElement.innerHTML = `
                <div style="display:flex;justify-content:flex-end;">
                  <div style="background:#4d7bbd;color:#fff;padding:8px 12px;border-radius:12px;max-width:70%;">
                    <div style="margin-bottom:4px;">${data.text}</div>
                    <div style="font-size:0.8em;opacity:0.8;">${timeString}</div>
                  </div>
                </div>
              `;
            } else {
              // 학생 메시지 (왼쪽 정렬) - 연한 회색 배경, 검은색 텍스트
              messageElement.innerHTML = `
                <div style="display:flex;justify-content:flex-start;">
                  <div style="background:#f1f3f4;color:#333;padding:8px 12px;border-radius:12px;max-width:70%;">
                    <div style="margin-bottom:4px;">${data.text}</div>
                    <div style="font-size:0.8em;opacity:0.8;">${timeString}</div>
                  </div>
                </div>
              `;
            }
            
            chatMessages.appendChild(messageElement);
          });
          
          // 스크롤을 맨 아래로
          chatMessages.scrollTop = chatMessages.scrollHeight;
        });
    }

    // 관리자 메시지 전송 함수
    function sendAdminMessage(studentName, studentId, chatId) {
      const chatInput = document.getElementById('chat-input');
      const message = chatInput.value.trim();
      
      if (!message) {
        alert('메시지를 입력해주세요.');
        return;
      }

      if (!currentAdmin) {
        alert('관리자 로그인이 필요합니다.');
        return;
      }

      const timestamp = new Date();
      
      // 관리자 이름 설정
      let adminName = '관리자';
      if (currentAdmin.email === 'director@dormi.com') {
        adminName = '실장님';
      } else if (currentAdmin.email === 'supervisor@dormi.com') {
        adminName = '사감님';
      } else if (currentAdmin.email === 'floor_manager@dormi.com') {
        adminName = '층장님';
      }
      
      // Firestore에 메시지 저장 - chats 컬렉션 사용
      db.collection('chats').doc(chatId).collection('messages').add({
        text: message,
        senderId: 'admin',
        senderName: adminName,
        timestamp: timestamp,
        isAdmin: true
      })
      .then(() => {
        // 채팅방 정보 업데이트
        return db.collection('chats').doc(chatId).set({
          lastMessage: message,
          lastMessageTime: timestamp,
          lastMessageBy: 'admin',
          updatedAt: timestamp
        }, {merge: true});
      })
      .then(() => {
        chatInput.value = '';
        console.log('관리자 메시지 전송 성공');
      })
      .catch((error) => {
        console.error('메시지 전송 오류:', error);
        alert('메시지 전송에 실패했습니다.');
      });
    }

    // 채팅 모달 닫기 함수
    function closeChatModal() {
      const modal = document.querySelector('div[style*="position:fixed"]');
      if (modal) modal.remove();
    }

    // 메시지 관리 페이지 표시
    function showMessageList() {
      console.log('showMessageList 함수 호출');
      console.log('현재 관리자:', currentAdmin);
      
      if (!currentAdmin) {
        console.log('관리자가 로그인되지 않음');
        const chatList = document.getElementById('chat-list');
        if (chatList) {
          chatList.innerHTML = `
            <div style="text-align:center;padding:40px;">
              <div style="margin-bottom:20px;color:#666;">관리자 로그인이 필요합니다.</div>
              <a href="admin_login.html" style="padding:12px 24px;font-size:1rem;font-weight:600;border:none;border-radius:8px;background:#4d7bbd;color:#fff;cursor:pointer;text-decoration:none;display:inline-block;">로그인 페이지로 이동</a>
            </div>
          `;
        }
        return;
      }
      
      console.log('관리자 로그인 확인됨, 채팅 목록 로드 시작');
      // 로그인된 경우 기존 로직 실행
      loadStudentChats();
    }
  </script>
</body>
</html> 